/*
Copyright 2012, KISSY UI Library v1.20
MIT Licensed
build time: Mar 28 11:38
*/
KISSY.add("dd/ddm",function(k,q,t,l,j,d){function o(){o.superclass.constructor.apply(this,arguments)}function g(b,i){var p=b.get("activeDrag"),y=p.get("mode"),v=b.get("drops"),u,w=0,C=0,B=n(p.get("node")),G=a(B);k.each(v,function(D){var x;if(x=D.getNodeFromTarget(i,p.get("dragNode")[0],p.get("node")[0]))if(y=="point"){if(e(n(x),p.mousePos)){x=a(n(x));if(u){if(x<C){u=D;C=x}}else{u=D;C=x}}}else if(y=="intersect"){x=a(c(B,n(x)));if(x>C){C=x;u=D}}else if(y=="strict"){x=a(c(B,n(x)));if(x==G){u=D;return false}}});
if((w=b.get("activeDrop"))&&w!=u){w._handleOut(i);p._handleOut(i)}b.set("activeDrop",u);if(u)w!=u?u._handleEnter(i):u._handleOver(i)}function f(b){var i=document;b._shim=(new j("<div style='background-color:red;position:"+(s?"absolute":"fixed")+";left:0;width:100%;height:100%;top:0;cursor:"+A.get("dragCursor")+";z-index:"+F+";'></div>")).prependTo(i.body||i.documentElement).css("opacity",0);f=m;s&&l.on(r,"resize scroll",E,b);m(b)}function m(b){var i=b.get("activeDrag").get("activeHandler"),p="auto";
if(i)p=i.css("cursor");if(p=="auto")p=b.get("dragCursor");b._shim.css({cursor:p,display:"block"});s&&E.call(b)}function n(b){var i=b.offset();return{left:i.left,right:i.left+b.outerWidth(),top:i.top,bottom:i.top+b.outerHeight()}}function e(b,i){return b.left<=i.left&&b.right>=i.left&&b.top<=i.top&&b.bottom>=i.top}function a(b){if(b.top>=b.bottom||b.left>=b.right)return 0;return(b.right-b.left)*(b.bottom-b.top)}function c(b,i){return{left:Math.max(b.left,i.left),right:Math.min(b.right,i.right),top:Math.max(b.top,
i.top),bottom:Math.min(b.bottom,i.bottom)}}var h=document,r=window,s=q.ie===6,z=k.throttle(function(b){var i=this.__activeToDrag,p=this.get("activeDrag");if(p||i)b.preventDefault();if(p){p._move(b);g(this,b)}else i&&i._move(b)},30),F=999999;o.ATTRS={prefixCls:{value:"ks-dd-"},dragCursor:{value:"move"},clickPixelThresh:{value:3},bufferTime:{value:1E3},activeDrag:{},activeDrop:{},drops:{value:[]}};var E=k.throttle(function(){var b;if((b=this.get("activeDrag"))&&b.get("shim"))this._shim.css({width:t.docWidth(),
height:t.docHeight()})},30);k.extend(o,d,{__activeToDrag:0,_regDrop:function(b){this.get("drops").push(b)},_unregDrop:function(b){b=k.indexOf(b,this.get("drops"));b!=-1&&this.get("drops").splice(b,1)},_regToDrag:function(b){l.on(h,"mouseup",this._end,this);l.on(h,"mousemove",z,this);this.__activeToDrag=b},_start:function(){var b=this.__activeToDrag;this.set("activeDrag",b);this.__activeToDrag=0;b.get("shim")&&f(this);this.fire("dragstart",{drag:b})},_end:function(){var b=this.get("activeDrag"),i=
this.get("activeDrop"),p={drag:b,drop:i};l.remove(h,"mousemove",z,this);l.remove(h,"mouseup",this._end,this);if(this.__activeToDrag){this.__activeToDrag._end();this.__activeToDrag=0}this._shim&&this._shim.hide();if(b){b._end();if(i){i._end();this.fire("drophit",p);this.fire("dragdrophit",p)}else this.fire("dragdropmiss",{drag:b});this.fire("dragend",{drag:b});this.set("activeDrag",null);this.set("activeDrop",null)}}});var A=new o;A.inRegion=e;A.region=n;A.area=a;return A},{requires:["ua","dom","event",
"node","base"]});
KISSY.add("dd/draggable",function(k,q,t,l,j){function d(){d.superclass.constructor.apply(this,arguments);this._init()}function o(){return false}function g(a){var c=a.target;this._checkMouseDown(a)&&this._check(c)&&this._prepare(a)}var f=k.each,m=q.ie,n=document;d.POINT="point";d.INTERSECT="intersect";d.STRICT="strict";d.ATTRS={node:{setter:function(a){return t.one(a)}},clickPixelThresh:{valueFn:function(){return j.get("clickPixelThresh")}},bufferTime:{valueFn:function(){return j.get("bufferTime")}},dragNode:{},
shim:{value:true},handlers:{value:[],getter:function(a){var c=this;a.length||(a[0]=c.get("node"));f(a,function(h,r){if(k.isFunction(h))h=h.call(c);if(k.isString(h)||h.nodeType)h=t.one(h);a[r]=h});c.__set("handlers",a);return a}},activeHandler:{},dragging:{value:false,setter:function(a){this.get("dragNode")[a?"addClass":"removeClass"](j.get("prefixCls")+"dragging")}},mode:{value:"point"},disabled:{value:false,setter:function(a){this.get("dragNode")[a?"addClass":"removeClass"](j.get("prefixCls")+"-disabled");
return a}},move:{value:false},primaryButtonOnly:{value:true},halt:{value:true}};var e;k.extend(d,l,{startMousePos:null,startNodePos:null,_diff:null,_bufferTimer:null,_init:function(){var a=this.get("node");this.set("dragNode",a);a.on("mousedown",g,this).on("dragstart",this._fixDragStart)},_fixDragStart:function(a){a.preventDefault()},destroy:function(){this.get("dragNode").detach("mousedown",g,this).detach("dragstart",this._fixDragStart);this.detach()},_check:function(a){var c=this,h=c.get("handlers"),
r=0;f(h,function(s){if(s.contains(a)||s[0]==a){r=1;c.set("activeHandler",s);return false}});return r},_checkMouseDown:function(a){if(this.get("primaryButtonOnly")&&a.button>1||this.get("disabled"))return 0;return 1},_prepare:function(a){var c=this;if(m){e=n.body.onselectstart;n.body.onselectstart=o}c.get("halt")?a.halt():a.preventDefault();var h=c.get("node"),r=a.pageX;a=a.pageY;h=h.offset();c.startMousePos=c.mousePos={left:r,top:a};c.startNodePos=h;c._diff={left:r-h.left,top:a-h.top};j._regToDrag(c);
if(r=c.get("bufferTime"))c._bufferTimer=setTimeout(function(){c._start()},r)},_clearBufferTimer:function(){if(this._bufferTimer){clearTimeout(this._bufferTimer);this._bufferTimer=0}},_move:function(a){var c,h=this._diff;c=this.startMousePos;var r=a.pageX;a=a.pageY;var s=r-h.left;h=a-h.top;if(this.get("dragging")){this.mousePos={left:r,top:a};c={left:s,top:h,pageX:r,pageY:a,drag:this};r=1;if(this.fire("drag",c)===false)r=0;if(j.fire("drag",c)===false)r=0;r&&this.get("move")&&this.get("node").offset(c)}else{h=
this.get("clickPixelThresh");if(Math.abs(r-c.left)>=h||Math.abs(a-c.top)>=h)this._start()}},_end:function(){var a;this._clearBufferTimer();if(m)n.body.onselectstart=e;if(this.get("dragging")){this.get("node").removeClass(j.get("prefixCls")+"drag-over");(a=j.get("activeDrop"))?this.fire("dragdrophit",{drag:this,drop:a}):this.fire("dragdropmiss",{drag:this});this.set("dragging",0);this.fire("dragend",{drag:this})}},_handleOut:function(){this.get("node").removeClass(j.get("prefixCls")+"drag-over");this.fire("dragexit",
{drag:this,drop:j.get("activeDrop")})},_handleEnter:function(a){this.get("node").addClass(j.get("prefixCls")+"drag-over");this.fire("dragenter",a)},_handleOver:function(a){this.fire("dragover",a)},_start:function(){this._clearBufferTimer();this.set("dragging",1);j._start();this.fire("dragstart",{drag:this})}});return d},{requires:["ua","node","base","./ddm"]});
KISSY.add("dd/droppable",function(k,q,t,l){function j(){j.superclass.constructor.apply(this,arguments);this._init()}j.ATTRS={node:{setter:function(d){if(d)return q.one(d)}}};k.extend(j,t,{getNodeFromTarget:function(d,o,g){d=this.get("node");var f=d[0];return f==o||f==g?null:d},_init:function(){l._regDrop(this)},__getCustomEvt:function(d){return k.mix({drag:l.get("activeDrag"),drop:this},d)},_handleOut:function(){var d=this.__getCustomEvt();this.get("node").removeClass(l.get("prefixCls")+"drop-over");
this.fire("dropexit",d);l.fire("dropexit",d);l.fire("dragexit",d)},_handleEnter:function(d){d=this.__getCustomEvt(d);d.drag._handleEnter(d);this.get("node").addClass(l.get("prefixCls")+"drop-over");this.fire("dropenter",d);l.fire("dragenter",d);l.fire("dropenter",d)},_handleOver:function(d){d=this.__getCustomEvt(d);d.drag._handleOver(d);this.fire("dropover",d);l.fire("dragover",d);l.fire("dropover",d)},_end:function(){var d=this.__getCustomEvt();this.get("node").removeClass(l.get("prefixCls")+"drop-over");
this.fire("drophit",d)},destroy:function(){l._unregDrop(this)}});return j},{requires:["node","base","./ddm"]});
KISSY.add("dd/proxy",function(k,q,t){function l(){l.superclass.constructor.apply(this,arguments);this[j]={}}var j="__proxy_destructors",d=k.stamp,o=k.guid("__dd_proxy"),g="__proxy";l.ATTRS={node:{value:function(f){return new q(f.get("node").clone(true))}},destroyOnEnd:{value:false},moveOnEnd:{value:true}};k.extend(l,t,{attach:function(f){function m(){var c=e.get("node"),h=f.get("node");if(e[g])c=e[g];else if(k.isFunction(c)){c=c(f);c.addClass("ks-dd-proxy");c.css("position","absolute");e[g]=c}h.parent().append(c);
c.show();c.offset(h.offset());f.__set("dragNode",h);f.__set("node",c)}function n(){var c=e[g];e.get("moveOnEnd")&&f.get("dragNode").offset(c.offset());if(e.get("destroyOnEnd")){c.remove();e[g]=0}else c.hide();f.__set("node",f.get("dragNode"))}var e=this,a=d(f,1,o);if(!(a&&e[j][a])){f.on("dragstart",m);f.on("dragend",n);a=d(f,0,o);e[j][a]={drag:f,fn:function(){f.detach("dragstart",m);f.detach("dragend",n)}}}},unAttach:function(f){f=d(f,1,o);var m=this[j];if(f&&m[f]){m[f].fn();delete m[f]}},destroy:function(){var f=
this.get("node"),m=this[j];f&&!k.isFunction(f)&&f.remove();for(var n in m)this.unAttach(m[n].drag)}});return l},{requires:["node","base"]});
KISSY.add("dd/draggable-delegate",function(k,q,t,l,j){function d(){d.superclass.constructor.apply(this,arguments)}function o(g){var f,m;if(this._checkMouseDown(g)){f=this.get("handlers");var n=new j(g.target);if(f=f.length?this._getHandler(n):n)m=this._getNode(f);if(m){this.__set("activeHandler",f);this.__set("node",m);this.__set("dragNode",m);this._prepare(g)}}}k.extend(d,t,{_init:function(){this.get("container").on("mousedown",o,this).on("dragstart",this._fixDragStart)},_getHandler:function(g){for(var f,
m=this.get("container"),n=this.get("handlers");g&&g[0]!==m[0];){k.each(n,function(e){if(l.test(g[0],e)){f=g;return false}});if(f)break;g=g.parent()}return f},_getNode:function(g){return g.closest(this.get("selector"),this.get("container"))},destroy:function(){this.get("container").detach("mousedown",o,this).detach("dragstart",this._fixDragStart);this.detach()}},{ATTRS:{container:{setter:function(g){return j.one(g)}},selector:{},handlers:{value:[],getter:0},disabled:{setter:function(g){this.get("container")[g?
"addClass":"removeClass"](q.get("prefixCls")+"-disabled");return g}}}});return d},{requires:["./ddm","./draggable","dom","node"]});
KISSY.add("dd/droppable-delegate",function(k,q,t,l,j){function d(){var g=this.get("container"),f=this.get("selector");this.__allNodes=g.all(f)}function o(){o.superclass.constructor.apply(this,arguments);q.on("dragstart",d,this)}k.extend(o,t,{getNodeFromTarget:function(g,f,m){var n={left:g.pageX,top:g.pageY};g=this.__allNodes;var e=0,a=Number.MAX_VALUE;g&&g.each(function(c){var h=c[0];if(!(h===m||h===f))if(q.inRegion(q.region(c),n)){h=q.area(q.region(c));if(h<a){a=h;e=c}}});if(e){this.set("lastNode",
this.get("node"));this.set("node",e)}return e},_handleOut:function(){o.superclass._handleOut.apply(this,arguments);this.set("node",0);this.set("lastNode",0)},_handleOver:function(g){var f=this.get("node"),m=o.superclass._handleOut,n=o.superclass._handleOver,e=o.superclass._handleEnter,a=this.get("lastNode");if(a[0]!==f[0]){this.set("node",a);m.apply(this,arguments);this.set("node",f);e.call(this,g)}else n.call(this,g)}},{ATTRS:{lastNode:{},selector:{},container:{setter:function(g){return j.one(g)}}}});
return o},{requires:["./ddm","./droppable","dom","node"]});
KISSY.add("dd/scroll",function(k,q,t,l,j){function d(){d.superclass.constructor.apply(this,arguments);this[m]={}}var o=k.Env.host,g=k.stamp,f=100,m="__dd_scrolls";d.ATTRS={node:{valueFn:function(){return l.one(o)},setter:function(e){return l.one(e)}},rate:{value:[10,10]},diff:{value:[20,20]}};var n=k.isWindow;k.extend(d,t,{getRegion:function(e){return n(e[0])?{width:j.viewportWidth(),height:j.viewportHeight()}:{width:e.outerWidth(),height:e.outerHeight()}},getOffset:function(e){return n(e[0])?{left:j.scrollLeft(),
top:j.scrollTop()}:e.offset()},getScroll:function(e){return{left:e.scrollLeft(),top:e.scrollTop()}},setScroll:function(e,a){e.scrollLeft(a.left);e.scrollTop(a.top)},unAttach:function(e){var a,c=this[m];if((a=g(e,1,"__dd-scroll-id-"))&&c[a]){c[a].fn();delete c[a]}},destroy:function(){var e=this[m],a;for(a in e)this.unAttach(e[a].drag)},attach:function(e){function a(){if(n(z[0]))return 0;var v=e.mousePos,u=q.region(z);if(!q.inRegion(u,v)){clearTimeout(y);y=0;return 1}return 0}function c(v){if(!v.fake)if(!a()){i=
v;p=k.clone(e.mousePos);v=s.getOffset(z);p.left-=v.left;p.top-=v.top;y||r()}}function h(){clearTimeout(y);y=null}function r(){if(!a()){var v=s.getRegion(z),u=v.width;v=v.height;var w=s.getScroll(z),C=k.clone(w),B=false;if(p.top-v>=-b[1]){w.top+=A[1];B=true}if(p.top<=b[1]){w.top-=A[1];B=true}if(p.left-u>=-b[0]){w.left+=A[0];B=true}if(p.left<=b[0]){w.left-=A[0];B=true}if(B){s.setScroll(z,w);y=setTimeout(r,f);i.fake=true;if(n(z[0])){w=s.getScroll(z);i.left+=w.left-C.left;i.top+=w.top-C.top}e.get("move")&&
e.get("node").offset(i);e.fire("drag",i)}else y=null}}var s=this,z=s.get("node"),F=g(e,0,"__dd-scroll-id-"),E=s[m];if(!E[F]){var A=s.get("rate"),b=s.get("diff"),i,p,y=null;e.on("drag",c);e.on("dragend",h);E[F]={drag:e,fn:function(){e.detach("drag",c);e.detach("dragend",h)}}}}});return d},{requires:["./ddm","base","node","dom"]});
KISSY.add("dd",function(k,q,t,l,j,d,o,g){q={Draggable:t,Droppable:l,DDM:q,Proxy:j,DraggableDelegate:d,DroppableDelegate:o,Scroll:g};k.mix(k,q);return q},{requires:["dd/ddm","dd/draggable","dd/droppable","dd/proxy","dd/draggable-delegate","dd/droppable-delegate","dd/scroll"]});
