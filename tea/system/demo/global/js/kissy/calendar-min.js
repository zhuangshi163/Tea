/*
Copyright 2012, KISSY UI Library v1.20
MIT Licensed
build time: Feb 20 10:28
*/
KISSY.add("calendar/base",function(j,m,k,n){function i(a,d){this._init(a,d)}var f=k.Target,b=m.all;j.augment(i,{_init:function(a,d){var e=b(a);this.id=this.C_Id=this._stamp(e);this._buildParam(d);if(this.popup){this.trigger=e;this.con=new m("<div>");b(document.body).append(this.con);this.C_Id=this._stamp(this.con);this.con.css({top:"0px",position:"absolute",background:"white",visibility:"hidden"})}else this.con=e;e=function(){};j.augment(e,f);e=new e;j.mix(this,e);this.render();this._buildEvent();
return this},render:function(a){var d=0,e,c;a=a||{};this._parseParam(a);this.con.addClass("ks-cal-call ks-clearfix multi-"+this.pages);this.ca=this.ca||[];for(d=0;d<this.ca.length;d++)this.ca[d].detachEvent();this.con.html("");this.ca.length=this.pages;d=0;for(c=[this.year,this.month];d<this.pages;d++){if(d===0)a=true;else{a=false;c=this._computeNextMonth(c)}e=d==this.pages-1;this.ca[d]=new this.Page({year:c[0],month:c[1],prevArrow:a,nextArrow:e,showTime:this.showTime},this);this.ca[d].render()}return this},
destroy:function(){for(var a=0;a<this.ca.length;a++)this.ca[a].detachEvent();j.each(this.EV,function(d){d&&d.target.detach(d.type,d.fn)});this.con.remove()},_stamp:function(a){a.attr("id")||a.attr("id",j.guid("K_Calendar"));return a.attr("id")},_showdate:function(a,d){var e=new Date(d-0+a*864E5);e=e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate();return new Date(e)},_buildEvent:function(){var a=this,d,e;if(!a.popup)return this;j.each(a.EV,function(c){c&&c.target.detach(c.type,c.fn)});a.EV=a.EV||
[];d=a.EV[0]={target:b(document),type:"click"};d.fn=function(c){var g=b(c.target);if(g.attr("id")!==a.C_Id)if(!((g.hasClass("ks-next")||g.hasClass("ks-prev"))&&g[0].tagName==="A"))if(g.attr("id")!=a.id)if(a.con.css("visibility")!="hidden")a.con.contains(g)&&(g[0].nodeName.toLowerCase()==="option"||g[0].nodeName.toLowerCase()==="select")||function(l,h){return l[0]>h[0].x&&l[0]<h[1].x&&l[1]>h[0].y&&l[1]<h[1].y}([c.pageX,c.pageY],[{x:a.con.offset().left,y:a.con.offset().top},{x:a.con.offset().left+a.con.width(),
y:a.con.offset().top+a.con.height()}])||a.hide()};d.target.on(d.type,d.fn);for(e=0;e<a.triggerType.length;e++){d=a.EV[e+1]={target:b("#"+a.id),type:a.triggerType[e],fn:function(c){c.target=b(c.target);c.preventDefault();var g=a.triggerType;if(j.inArray("click",g)&&j.inArray("focus",g))c.type=="focus"&&a.toggle();else if(j.inArray("click",g)&&!j.inArray("focus",g))c.type=="click"&&a.toggle();else!j.inArray("click",g)&&j.inArray("focus",g)?setTimeout(function(){a.toggle()},170):a.toggle()}};d.target.on(d.type,
d.fn)}return this},toggle:function(){this.con.css("visibility")=="hidden"?this.show():this.hide()},show:function(){this.con.css("visibility","");var a=this.trigger.offset().left,d=this.trigger.outerHeight()||this.trigger.height();d=this.trigger.offset().top+d;this.con.css("left",a.toString()+"px");this.con.css("top",d.toString()+"px");this.fire("show");return this},hide:function(){this.con.css("visibility","hidden");this.fire("hide");return this},_buildParam:function(a){function d(l,h){var o=a[h];
e[h]=o===n||o===null?l:o}var e=this;if(a===n||a===null)a={};j.each({date:new Date,startDay:0,pages:1,closable:false,rangeSelect:false,minDate:false,maxDate:false,multiSelect:false,navigator:true,popup:false,showTime:false,triggerType:["click"]},d);if(typeof a.triggerType==="string")a.triggerType=[a.triggerType];d(e.date,"selected");if(a.startDay)e.startDay=(7-a.startDay)%7;if(a.range!==n&&a.range!==null){var c=e._showdate(1,new Date(a.range.start.getFullYear()+"/"+(a.range.start.getMonth()+1)+"/"+
a.range.start.getDate())),g=e._showdate(1,new Date(a.range.end.getFullYear()+"/"+(a.range.end.getMonth()+1)+"/"+a.range.end.getDate()));e.range={start:c,end:g}}else e.range={start:null,end:null};e.EV=[];return this},_parseParam:function(a){var d;if(a===n||a===null)a={};for(d in a)this[d]=a[d];this._handleDate();return this},_templetShow:function(a,d){var e,c,g,l;if(d instanceof Array){e="";for(c=0;c<d.length;c++)e+=arguments.callee(a,d[c]);a=e}else{e=a.match(/{\$(.*?)}/g);if(d!==n&&e!==null){c=0;
for(g=e.length;c<g;c++){l=e[c].replace(/({\$)|}/g,"");l=d[l]!==n?d[l]:"";a=a.replace(e[c],l)}}}return a},_handleDate:function(){var a=this.date;this.weekday=a.getDay()+1;this.day=a.getDate();this.month=a.getMonth();this.year=a.getFullYear();return this},_getHeadStr:function(a,d){return a.toString()+"\u5e74"+(Number(d)+1).toString()+"\u6708"},_monthAdd:function(){if(this.month==11){this.year++;this.month=0}else this.month++;this.date=new Date(this.year.toString()+"/"+(this.month+1).toString()+"/1");return this},
_monthMinus:function(){if(this.month===0){this.year--;this.month=11}else this.month--;this.date=new Date(this.year.toString()+"/"+(this.month+1).toString()+"/1");return this},_computeNextMonth:function(a){var d=a[0];a=a[1];if(a==11){d++;a=0}else a++;return[d,a]},_handleOffset:function(){var a=["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"],d=this.startDay,e="";e=[];for(var c=0;c<7;c++)e[c]={day:a[(c-d+7)%7]};e=this._templetShow("<span>{$day}</span>",e);return{day_html:e}},_handleRange:function(a){if(this.range.start===
null&&this.range.end===null||this.range.start!==null&&this.range.end!==null){this.range.start=a;this.range.end=null;this.render()}else if(this.range.start!==null&&this.range.end===null){this.range.end=a;if(this.range.start.getTime()>this.range.end.getTime()){a=this.range.start;this.range.start=this.range.end;this.range.end=a}this.fire("rangeSelect",this.range);this.render()}return this}});return i},{requires:["node","event"]});
KISSY.add("calendar/date",function(){var j=function(){var m=/w{1}|d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,k=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,n=/[^-+\dA-Z]/g,i=function(a,d){a=String(a);for(d=d||2;a.length<d;)a="0"+a;return a},f={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",longTime:"h:MM:ss TT Z",
isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUTCDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",localShortDate:"yy\u5e74mm\u6708dd\u65e5",localShortDateTime:"yy\u5e74mm\u6708dd\u65e5 hh:MM:ss TT",localLongDate:"yyyy\u5e74mm\u6708dd\u65e5",localLongDateTime:"yyyy\u5e74mm\u6708dd\u65e5 hh:MM:ss TT",localFullDate:"yyyy\u5e74mm\u6708dd\u65e5 w",localFullDateTime:"yyyy\u5e74mm\u6708dd\u65e5 w hh:MM:ss TT"},b={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","\u661f\u671f\u65e5","\u661f\u671f\u4e00","\u661f\u671f\u4e8c","\u661f\u671f\u4e09","\u661f\u671f\u56db","\u661f\u671f\u4e94",
"\u661f\u671f\u516d"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};return function(a,d,e){if(arguments.length==1&&Object.prototype.toString.call(a)=="[object String]"&&!/\d/.test(a)){d=a;a=undefined}a=a?new Date(a):new Date;if(isNaN(a))throw SyntaxError("invalid date");d=String(f[d]||d||f["default"]);if(d.slice(0,4)=="UTC:"){d=d.slice(4);e=true}var c=e?"getUTC":"get",
g=a[c+"Date"](),l=a[c+"Day"](),h=a[c+"Month"](),o=a[c+"FullYear"](),p=a[c+"Hours"](),s=a[c+"Minutes"](),t=a[c+"Seconds"]();c=a[c+"Milliseconds"]();var r=e?0:a.getTimezoneOffset(),u={d:g,dd:i(g,undefined),ddd:b.dayNames[l],dddd:b.dayNames[l+7],w:b.dayNames[l+14],m:h+1,mm:i(h+1,undefined),mmm:b.monthNames[h],mmmm:b.monthNames[h+12],yy:String(o).slice(2),yyyy:o,h:p%12||12,hh:i(p%12||12,undefined),H:p,HH:i(p,undefined),M:s,MM:i(s,undefined),s:t,ss:i(t,undefined),l:i(c,3),L:i(c>99?Math.round(c/10):c,undefined),
t:p<12?"a":"p",tt:p<12?"am":"pm",T:p<12?"A":"P",TT:p<12?"AM":"PM",Z:e?"UTC":(String(a).match(k)||[""]).pop().replace(n,""),o:(r>0?"-":"+")+i(Math.floor(Math.abs(r)/60)*100+Math.abs(r)%60,4),S:["th","st","nd","rd"][g%10>3?0:(g%100-g%10!=10)*g%10]};return d.replace(m,function(q){return q in u?u[q]:q.slice(1,q.length-1)})}}();return{format:function(m,k,n){return j(m,k,n)},parse:function(m){var k=null;if(k instanceof Date)m=k;else{k=new Date(m);m=k instanceof Date&&k!="Invalid Date"&&!isNaN(k)?k:null}return m}}});
KISSY.add("calendar/page",function(j,m,k,n){j.augment(n,{Page:function(i,f){this.father=f;this.month=Number(i.month);this.year=Number(i.year);this.prevArrow=i.prevArrow;this.nextArrow=i.nextArrow;this.timmer=this.node=null;this.id="";this.EV=[];this.html=['<div class="ks-cal-box" id="{$id}"><div class="ks-cal-hd"><a href="javascript:void(0);" class="ks-prev {$prev}"><</a><a href="javascript:void(0);" class="ks-title">{$title}</a><a href="javascript:void(0);" class="ks-next {$next}">></a></div><div class="ks-cal-bd"><div class="ks-whd">',
f._handleOffset().day_html,'</div><div class="ks-dbd ks-clearfix">{$ds}</div></div><div class="ks-setime hidden"></div><div class="ks-cal-ft {$showtime}"><div class="ks-cal-time">\u65f6\u95f4\uff1a00:00 &hearts;</div></div><div class="ks-selectime hidden"></div></div><!--#ks-cal-box--\>'].join("");this.nav_html='<p>\u6708<select value="{$the_month}"><option class="m1" value="1">01</option><option class="m2" value="2">02</option><option class="m3" value="3">03</option><option class="m4" value="4">04</option><option class="m5" value="5">05</option><option class="m6" value="6">06</option><option class="m7" value="7">07</option><option class="m8" value="8">08</option><option class="m9" value="9">09</option><option class="m10" value="10">10</option><option class="m11" value="11">11</option><option class="m12" value="12">12</option></select></p><p>\u5e74<input type="text" value="{$the_year}" onfocus="this.select()"/></p><p><button class="ok">\u786e\u5b9a</button><button class="cancel">\u53d6\u6d88</button></p>';
this.Verify=function(){return{isDay:function(b){if(!/^\d+$/i.test(b))return false;b=Number(b);return!(b<1||b>31)},isYear:function(b){if(!/^\d+$/i.test(b))return false;b=Number(b);return!(b<100||b>1E4)},isMonth:function(b){if(!/^\d+$/i.test(b))return false;b=Number(b);return!(b<1||b>12)}}};this._renderUI=function(){var b={};this.HTML="";b.prev="";b.next="";b.title="";b.ds="";if(!this.prevArrow)b.prev="hidden";if(!this.nextArrow)b.next="hidden";if(!this.father.showtime)b.showtime="hidden";b.id=this.id=
"ks-cal-"+Math.random().toString().replace(/.\./i,"");b.title=this.father._getHeadStr(this.year,this.month);this.createDS();b.ds=this.ds;this.father.con.append(this.father._templetShow(this.html,b));this.node=k.one("#"+this.id);if(this.father.showTime){b=this.node.one(".ks-cal-ft");b.removeClass("hidden");this.timmer=new this.father.TimeSelector(b,this.father)}return this};this.detachEvent=function(){this.EV=this.EV||[];j.each(this.EV,function(b){b&&b.target.detach(b.type,b.fn)})};this._buildEvent=
function(){function b(){d.target.on(d.type,d.fn)}var a=this,d,e=k.one("#"+a.id);j.each(a.EV,function(c){c&&c.target.detach(c.type,c.fn)});a.EV=a.EV||[];d=a.EV[0]={target:e.one("div.ks-dbd"),type:"click",fn:function(c){c.target=k(c.target);if(!c.target.hasClass("ks-null"))if(!c.target.hasClass("ks-disabled")){c=Number(c.target.html());var g=new Date("2010/01/01");g.setYear(a.year);g.setMonth(a.month);g.setDate(c);a.father.dt_date=g;a.father.fire("select",{date:g});a.father.popup&&a.father.closable&&
a.father.hide();a.father.rangeSelect&&a.father._handleRange(g);a.father.render({selected:g})}}};b();d=a.EV[1]={target:e.one("a.ks-prev"),type:"click",fn:function(c){c.preventDefault();a.father._monthMinus().render();a.father.fire("monthChange",{date:new Date(a.father.year+"/"+(a.father.month+1)+"/01")})}};b();d=a.EV[2]={target:e.one("a.ks-next"),type:"click",fn:function(c){c.preventDefault();a.father._monthAdd().render();a.father.fire("monthChange",{date:new Date(a.father.year+"/"+(a.father.month+
1)+"/01")})}};b();if(a.father.navigator){d=a.EV[3]={target:e.one("a.ks-title"),type:"click",fn:function(c){try{a.timmer.hidePopup();c.preventDefault()}catch(g){}c.target=k(c.target);c=e.one(".ks-setime");c.html("");var l=a.father._templetShow(a.nav_html,{the_month:a.month+1,the_year:a.year});c.html(l);c.removeClass("hidden");e.one("input").on("keydown",function(h){h.target=k(h.target);if(h.keyCode==38){h.target.val(Number(h.target.val())+1);h.target[0].select()}if(h.keyCode==40){h.target.val(Number(h.target.val())-
1);h.target[0].select()}if(h.keyCode==13){h=e.one(".ks-setime").one("select").val();var o=e.one(".ks-setime").one("input").val();e.one(".ks-setime").addClass("hidden");if(a.Verify().isYear(o))if(a.Verify().isMonth(h)){a.father.render({date:new Date(o+"/"+h+"/01")});a.father.fire("monthChange",{date:new Date(o+"/"+h+"/01")})}}})}};b();d=a.EV[4]={target:e.one(".ks-setime"),type:"click",fn:function(c){c.preventDefault();c.target=k(c.target);if(c.target.hasClass("ok")){c=e.one(".ks-setime").one("select").val();
var g=e.one(".ks-setime").one("input").val();e.one(".ks-setime").addClass("hidden");if(a.Verify().isYear(g))if(a.Verify().isMonth(c)){a.father.render({date:new Date(g+"/"+c+"/01")});a.father.fire("monthChange",{date:new Date(g+"/"+c+"/01")})}}else c.target.hasClass("cancel")&&e.one(".ks-setime").addClass("hidden")}};b()}return this};this._getNode=function(){return this.node};this._getNumOfDays=function(b,a){return 32-(new Date(b,a-1,32)).getDate()};this.createDS=function(){var b="",a=(7-this.father.startDay+
(new Date(this.year+"/"+(this.month+1)+"/01")).getDay())%7,d=this._getNumOfDays(this.year,this.month+1),e=this.father.selected,c=new Date,g;for(g=0;g<a;g++)b+='<a href="javascript:void(0);" class="ks-null">0</a>';for(g=1;g<=d;g++){a="";var l=new Date(this.year,this.month,g);if(this.father.minDate&&new Date(this.year,this.month,g+1)<this.father.minDate||this.father.maxDate&&l>this.father.maxDate)a="ks-disabled";else if(this.father.range&&l>=this.father.range.start&&l<=this.father.range.end)a="ks-range";
else if(e&&e.getFullYear()==this.year&&e.getMonth()==this.month&&e.getDate()==g)a="ks-selected";if(c.getFullYear()==this.year&&c.getMonth()==this.month&&c.getDate()==g)a+=" ks-today";b+="<a "+(a?"class="+a:"")+' href="javascript:void(0);">'+g+"</a>"}this.ds=b;return this};this.render=function(){this._renderUI();this._buildEvent();return this}}});return n},{requires:["ua","node","calendar/base"]});
KISSY.add("calendar/time",function(j,m,k){j.augment(k,{TimeSelector:function(n,i){this.father=i;this.fcon=n.parent(".ks-cal-box");this.popupannel=this.fcon.one(".ks-selectime");if(typeof i._time=="undefined")i._time=new Date;this.time=i._time;this.status="s";this.ctime=m('<div class="ks-cal-time">\u65f6\u95f4\uff1a<span class="h">h</span>:<span class="m">m</span>:<span class="s">s</span><!--{{arrow--\><div class="cta"><button class="u"></button><button class="d"></button></div><!--arrow}}--\></div>');this.button=
m('<button class="ct-ok">\u786e\u5b9a</button>');this.h_a=["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"];this.m_a=["00","10","20","30","40","50"];this.s_a=["00","10","20","30","40","50"];this.parseSubHtml=function(f){for(var b="",a=0;a<f.length;a++)b+='<a href="javascript:void(0);" class="item">'+f[a]+"</a>";b+='<a href="javascript:void(0);" class="x">x</a>';return b};this.showPopup=function(f){this.popupannel.html(f);this.popupannel.removeClass("hidden");
f=this.status;this.ctime.all("span").removeClass("on");switch(f){case "h":this.ctime.all(".h").addClass("on");break;case "m":this.ctime.all(".m").addClass("on");break;case "s":this.ctime.all(".s").addClass("on")}};this.hidePopup=function(){this.popupannel.addClass("hidden")};this.render=function(){var f=this.get("h"),b=this.get("m"),a=this.get("s");this.father._time=this.time;this.ctime.all(".h").html(f);this.ctime.all(".m").html(b);this.ctime.all(".s").html(a);return this};this.set=function(f,b){b=
Number(b);switch(f){case "h":this.time.setHours(b);break;case "m":this.time.setMinutes(b);break;case "s":this.time.setSeconds(b)}this.render()};this.get=function(f){var b=this.time;switch(f){case "h":return b.getHours();case "m":return b.getMinutes();case "s":return b.getSeconds()}};this.add=function(){var f=this.status,b=this.get(f);b++;this.set(f,b)};this.minus=function(){var f=this.status,b=this.get(f);b--;this.set(f,b)};this._init=function(){var f=this;n.html("").append(f.ctime);n.append(f.button);
f.render();f.popupannel.on("click",function(b){b=m(b.target);if(b.hasClass("x"))f.hidePopup();else if(b.hasClass("item")){b=Number(b.html());f.set(f.status,b);f.hidePopup()}});f.button.on("click",function(){var b=typeof f.father.dt_date=="undefined"?f.father.date:f.father.dt_date;b.setHours(f.get("h"));b.setMinutes(f.get("m"));b.setSeconds(f.get("s"));f.father.fire("timeSelect",{date:b});f.father.popup&&f.father.closable&&f.father.hide()});f.ctime.on("keyup",function(b){if(b.keyCode==38||b.keyCode==
37){b.preventDefault();f.add()}if(b.keyCode==40||b.keyCode==39){b.preventDefault();f.minus()}});f.ctime.one(".u").on("click",function(){f.hidePopup();f.add()});f.ctime.one(".d").on("click",function(){f.hidePopup();f.minus()});f.ctime.one(".h").on("click",function(){var b=f.parseSubHtml(f.h_a);f.status="h";f.showPopup(b)});f.ctime.one(".m").on("click",function(){var b=f.parseSubHtml(f.m_a);f.status="m";f.showPopup(b)});f.ctime.one(".s").on("click",function(){var b=f.parseSubHtml(f.s_a);f.status="s";
f.showPopup(b)})};this._init()}});return k},{requires:["node","calendar/base"]});KISSY.add("calendar",function(j,m,k,n,i){j.Calendar=m;j.Date=i;m.Date=i;return m},{requires:["calendar/base","calendar/page","calendar/time","calendar/date"]});
