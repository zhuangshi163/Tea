KISSY.add("gallery/tooltip/1.0/index",function(f){var p={top:"arrow-top",left:"arrow-left",right:"arrow-right",bottom:"arrow-bottom"};return{attach:function(b){var c=this,d=f.all(b.trigger),g=f.all(b.tooltip),h=b.onShow;d.each(function(d){var d=f.one(d),i=f.one(d.all(b.refer))||d;b.onShow=function(d,f){c.locate(i,g,b);h&&h(d,f)};c.connect(d,g,b)})},freeze:function(b){var c=f.one(b.tooltip);this.locate(f.one(b.refer),c,b);f.one(c).show()},connect:function(b,c,d){var b=f.one(b),c=f.one(c),d=d||{},g=
d.onHide,h=d.onShow;b.on("mouseenter",function(){h&&h(b,c);clearTimeout(c.attr("data-hide-timer"));c.show()});b.on("mouseleave",function(){c.attr("data-hide-timer",setTimeout(function(){g&&g(b,c);c.hide()},200))});c.on("mouseover",function(){c.show();clearTimeout(c.attr("data-hide-timer"))});c.on("mouseleave",function(){g&&g(b,c);c.hide()})},locate:function(b,c,d){var b=f.one(b),c=f.one(c),d=d||{},g=f.one(d.container),h=d.position;c.css({visibility:"hidden",position:"absolute"});c.show();var s=d.gap||
0,i=d.arrowAlign||"center",j=d.align||"center",d=c.all(d.arrowHook||".J_TooltipArrow"),v=f.one(window).height(),r=f.one(window).width(),w=f.DOM.scrollTop(),x=f.DOM.scrollLeft();g&&(v=g.outerHeight(),r=g.outerWidth(),w=g.scrollTop(),x=g.scrollLeft());var e=b.offset(),m=b.outerWidth(),n=b.outerHeight();g&&(e.left-=g.offset().left,e.top-=g.offset().top);var b=c.outerWidth(),q=c.outerHeight(),k=d.outerWidth(),l=d.outerHeight()/2;c.hide();c.css("visibility","visible");var a={top:null,left:null,arrowPos:null,
arrowTop:null,arrowLeft:null},o={},a={};a.top=e.top+n+s+l;a.left="center"==j?e.left+(m-b)/2:"left"==j?e.left:e.left+(m-b);a.arrowPos="top";a.arrowLeft="center"==i?e.left+m/2-k/2:"left"==i?e.left-k/2:e.left+m-k/2;o.bottom=a;a={};a.top=e.top-s-q-l;a.left="center"==j?e.left+(m-b)/2:"left"==j?e.left:e.left+(m-b);a.arrowPos="bottom";a.arrowLeft="center"==i?e.left+m/2-k/2:"left"==i?e.left-k/2:e.left+m-k/2;o.top=a;a={};a.left=e.left-s-b-k;a.top="center"==j?e.top+(n-q)/2:"left"==j?e.top:e.top+(n-q);a.arrowPos=
"right";a.arrowTop="center"==i?e.top+n/2-l/2:"left"==i?e.top-l/2:e.top+n-l/2;o.left=a;a={};a.left=e.left+m+s+k;a.top="center"==j?e.top+(n-q)/2:"left"==j?e.top:e.top+(n-q);a.arrowPos="left";a.arrowTop="center"==i?e.top+n/2-l/2:"left"==i?e.top-l/2:e.top+n-l/2;o.right=a;if(h&&o[h])a=o[h];else{var t,y,u;for(t in o)if(a=o[t],h=this._calculateArea(w,x,r,v,a.top,a.left,b,q),h=h.area,!u||h>y)u=t,y=h;a=o[u]}if(null!==a.arrowTop&&(a.top>a.arrowTop&&(a.arrowTop=a.top+l),a.arrowTop+l>a.top+q))a.arrowTop=a.top+
q-3*l;null!==a.arrowTop&&(a.arrowTop-=a.top);if(null!==a.arrowLeft&&(a.left>a.arrowLeft&&(a.arrowLeft=a.left+k),a.arrowLeft+k>a.left+b))a.arrowLeft=a.left+b-3*k;null!==a.arrowLeft&&(a.arrowLeft-=a.left);g?(g.css("position","relative"),g.append(c)):f.one(document.body).append(c);c.css({top:a.top,left:a.left});d.removeClass(p.top);d.removeClass(p.left);d.removeClass(p.right);d.removeClass(p.bottom);d.addClass(p[a.arrowPos]);d.css({top:a.arrowTop||"",left:a.arrowLeft||""})},_calculateArea:function(b,
c,d,g,h,f,i,j){var p=b<h?h:b,r=c<f?f:c,b=b+g>h+j?h+j:b+g,c=c+d>f+i?f+i:c+d;return{area:(c-r)*(b-p),ifIn:p==h&&r==f&&b==h+j&&c==f+i}}}});
