KISSY.add("gallery/kcharts/1.0/linechart/index",function(f,q,u,m,v,s,w,t){var i=f.all,k=f.Event,p="ks-chart-default",o,q=function(a){this._cfg=a;this.init()};f.extend(q,m,{init:function(){m.prototype.init.call(this,this._cfg);var a={themeCls:p,autoRender:!0,comparable:!1,lineType:"straight",colors:[],title:{content:"",css:{"text-align":"center","font-size":"16px"},isShow:!0},subTitle:{content:"",css:{"text-align":"center","font-size":"12px"},isShow:!0},points:{attr:{stroke:"#fff",r:4,"stroke-width":1.5,
fill:"{COLOR}"},hoverAttr:{stroke:"#fff",r:5,fill:"{COLOR}","stroke-width":0}},xLabels:{isShow:!0,css:{}},yLabels:{isShow:!0,css:{}},xAxis:{isShow:!0,css:{}},yAxis:{isShow:!0,css:{},num:5},xGrids:{isShow:!0,css:{}},yGrids:{isShow:!0,css:{}},areas:{isShow:!0,css:{}},line:{isShow:!0,attr:{"stroke-width":"3px"},hoverAttr:{}},pointLines:{isShow:!1,css:{}},tip:{isShow:!0,clsName:"",template:"",css:{},offset:{x:0,y:0},boundryDetect:!0}};this._lines={};this._finished=[];this._cfg=f.mix(a,this._cfg,t,t,!0);
p=this._cfg.themeCls;this.color=o=new v;0<this._cfg.colors.length&&o.removeAllColors();for(var b in this._cfg.colors)o.setColor(this._cfg.colors[b]);this._cfg.autoRender&&this.render(!0)},drawTitle:function(){var a=this.htmlPaper,b=p+"-title",c=this._cfg,d=0.6*this._innerContainer.y;c.title.isShow&&""!=c.title.content&&(this._title=a.rect(0,0,this._$ctnNode.width(),d).addClass(b).css(f.mix({"line-height":d+"px"},c.title.css)).html(c.title.content))},drawSubTitle:function(){var a=this.htmlPaper,b=
p+"-subtitle",c=this._cfg,d=this._innerContainer,g=0.4*d.y;c.subTitle.isShow&&""!=c.subTitle.content&&(this._subTitle=a.rect(0,0.6*d.y,this._$ctnNode.width(),g).addClass(b).css(f.mix({"line-height":g+"px"},c.subTitle.css)).html(c.subTitle.content))},animateLine:function(a,b,c){if(a&&a.length){var d=this,g=d.paper,l=f.mix({stroke:o.getColor(b).DEFAULT},d._cfg.line.attr),e=a.length,r=[],h,i=d._cfg.anim.duration||100,k=d._cfg.anim.easing||"easeIn",j=1,n="",m=function(){if(a[j]&&a[j].x&&a[j].y&&j<e){if("arc"==
d._cfg.lineType){var l=(a[j].x+a[j-1].x)/2;n+=" C"+l+","+a[j-1].y+","+l+","+a[j].y+","+a[j].x+","+a[j].y}else n+=" L"+a[j].x+","+a[j].y;h&&h.animate({path:n},i,k,function(){r[j]=d.drawStock(a[j].x,a[j].y,d._stocks[b].attr);j++;m();j==e&&(d._stocks[b].stocks=r,d._finished.push(!0),c&&d._finished.length==d._cfg.series.length&&c())})}},n=n+("M"+a[0].x+","+a[0].y);h=g.path(n).attr(l);r[0]=d.drawStock(a[0].x,a[0].y,d.processAttr(d._cfg.points.attr,o.getColor(b).DEFAULT));m();return h}},getLinePath:function(a){var b;
if(!a||!a[0]||!a[0].x||!a[0].y)return"";b=""+("M"+a[0].x+","+a[0].y);if("arc"==this._cfg.lineType)for(var c=1,d=a.length;c<d;c++){if(a[c].x&&a[c].y){var g=(a[c].x+a[c-1].x)/2;b+=" C"+g+","+a[c-1].y+","+g+","+a[c].y+","+a[c].x+","+a[c].y}}else{c=1;for(d=a.length;c<d;c++)a[c].x&&a[c].y&&(b+=" L"+a[c].x+","+a[c].y)}return b},drawLine:function(a,b){if(a)return this.paper.path(a).attr(f.mix(this._cfg.line.attr,b))},drawLines:function(a){var b=this._cfg;this._lines={};this._stocks={};if(b.anim)for(var c in this._points){var b=
this.getLinePath(this._points[c]),d=o.getColor(c),g=this.processAttr(this._cfg.points.attr,d.DEFAULT),l=this.processAttr(this._cfg.points.hoverAttr,d.HOVER);this._lines[c]={line:this.animateLine(this._points[c],c,a),path:b,points:this._points[c],color:d,attr:f.mix({stroke:d.DEFAULT},this._cfg.line.attr)};this._stocks[c]={points:this._points[c],color:d,attr:g,hoverAttr:l}}else for(c in this._points)b=this.getLinePath(this._points[c]),d=o.getColor(c),g=this.processAttr(this._cfg.points.attr,d.DEFAULT),
l=this.processAttr(this._cfg.points.hoverAttr,d.HOVER),this._lines[c]={line:this.drawLine(b,{stroke:d.DEFAULT}),path:b,points:this._points[c],color:d,attr:f.mix({stroke:d.DEFAULT},this._cfg.line.attr)},this._stocks[c]={stocks:this.drawStocks(this._points[c],g),points:this._points[c],color:d,attr:g,hoverAttr:l};return this._lines},processAttr:function(a,b){var c=f.clone(a),d;for(d in c)c[d]&&"string"==typeof c[d]&&(c[d]=c[d].replace("{COLOR}",b));return c},drawStocks:function(a,b){var c=[],d;for(d in a)a[d].x&&
a[d].y?c.push(this.drawStock(a[d].x,a[d].y,b)):c.push("");return c},drawStock:function(a,b,c){var d=this._cfg.points.attr;return this.paper.circle(a,b,d.r,c).attr(d).attr(c)},drawGridsX:function(){for(var a=this._centerPoints,b=0,c=a.length;b<c;b++)this._gridsX.push(this.drawGridX(a[b]));return this._gridsX},drawGridX:function(a){var b=this._cfg.themeCls+"-gridsx";return this.htmlPaper.lineY(a.x,this._innerContainer.tl.y,this._innerContainer.height).addClass(b).css(this._cfg.xGrids.css)},drawGridY:function(a,
b){var c=this._innerContainer.width,b=b||this._cfg.yGrids.css,d=this._cfg.themeCls+"-gridsy";return this.htmlPaper.lineX(a.x,a.y,c).addClass(d).css(b)},drawGridsY:function(){for(var a=this._innerContainer.tl.x,b=this._pointsY,c=0,d=b.length;c<d;c++)this._gridsY[c]={"0":this.drawGridY({x:a,y:b[c].y}),num:this.coordNum[c]}},drawAreas:function(){for(var a=this._innerContainer.tl.y,b=this._points[0],c=b[1].x-b[0].x,d=this._innerContainer.height,g=this.htmlPaper,l=this._cfg.themeCls+"-areas",e=this._cfg.areas.css,
f=0,h=b.length;f<h;f++)this._areas.push(g.rect(b[f].x-c/2,a,c,d).addClass(l).css(e))},drawAxisX:function(){var a=this._innerContainer,b=a.bl,c=this._cfg.themeCls+"-axisx";return this._axisX=this.htmlPaper.lineX(b.x,b.y,a.width).addClass(c).css(this._cfg.xAxis.css||{})},drawAxisY:function(){var a=this._innerContainer,b=a.tl,c=this._cfg.themeCls+"-axisy";return this._axisY=this.htmlPaper.lineY(b.x,b.y,a.height).addClass(c).css(this._cfg.yAxis.css||{})},drawLabelsX:function(){var a=this._cfg.xAxis.text,
b;for(b in a)this._labelX[b]=this.drawLabelX(b,a[b])},drawLabelsY:function(){for(var a in this._pointsY)this._labelY[a]={"0":this.drawLabelY(a,this._pointsY[a].number),num:this._pointsY[a].number};return this._labelY},drawLabelX:function(a,b){var c=this.htmlPaper,d=this._pointsX,g=this._cfg.themeCls+"-xlabels";if(a<(d.length||0))return d=d[a],d[0]=c.text(d.x,d.y,"<span class="+g+">"+b+"</span>","center").css(this._cfg.xLabels.css),d[0]},drawLabelY:function(a,b){return this.htmlPaper.text(this._pointsY[a].x,
this._pointsY[a].y,"<span class="+(this._cfg.themeCls+"-ylabels")+">"+b+"</span>","right","middle").css(this._cfg.yLabels.css)},drawPointLines:function(){var a=this.htmlPaper,b=this._cfg.themeCls+"-pointlines",c=this._innerContainer;this._pointlines=[];for(var d in this._pointsX)this._pointlines.push(a.lineY(this._pointsX[d].x,c.tl.y,c.height).addClass(b).css({display:"none"}));return this._pointlines},renderTip:function(){var a=this._cfg,b=this._innerContainer,a=f.mix(a.tip,{rootNode:this._$ctnNode,
clsName:a.themeCls,boundry:a.tip.boundryDetect?{x:b.tl.x,y:b.tl.y,width:b.width,height:b.height}:{}});return this.tip=new w(a)},renderEvtLayout:function(){for(var a=this._innerContainer,b=this._points[0],c=b[1].x-b[0].x,d=a.height,g=this._multiple,l=this._evtEls._areas=[],e=this._evtEls._rects=[],f=this._evtEls.paper=new s(this._$ctnNode,{clsName:"ks-chart-evtlayout",prependTo:!1,width:a.width,height:d,left:a.tl.x,top:a.tl.y}),h=0,e=b.length;h<e;h++)l[h]=f.rect(b[h].x-c/2,a.tl.y,c,d).addClass("ks-chart-evtlayout-areas");
if(g)for(h in this._stocks)if(a=this._stocks[h],e=[],b=a.points,a.stocks){for(var i in b)e[i]=f.rect(b[i].x-c/2,b[i].y-5,c,10).attr({line_index:h,index:i}).addClass("ks-chart-evtlayout-rects");this._evtEls._rects[h]=e}},clearEvtLayout:function(){if(this._evtEls._areas)for(var a in this._evtEls._areas)this._evtEls._areas[a].remove();if(this._evtEls._rects)for(a in this._evtEls._rects)for(var b in this._evtEls._rects[a])this._evtEls._rects[a][b].remove()},render:function(a){var b=this,c=b._cfg,d=c.themeCls;
a&&b._$ctnNode.html("");b.paper=u(b._$ctnNode[0],c.width,c.height,{position:"absolute"});b.htmlPaper=new s(b._$ctnNode,{clsName:d});b.drawTitle();b.drawSubTitle();c.tip.isShow&&b.renderTip();c.areas.isShow&&b.drawAreas();c.xGrids.isShow&&b.drawGridsX();c.yGrids.isShow&&b.drawGridsY();c.pointLines.isShow&&b.drawPointLines();c.xAxis.isShow&&b.drawAxisX();c.yAxis.isShow&&b.drawAxisY();c.xLabels.isShow&&b.drawLabelsX();c.yLabels.isShow&&b.drawLabelsY();c.anim?b.drawLines(function(){b.renderEvtLayout();
b.bindEvt();f.log("finish");b.afterRender()}):(b.drawLines(),b.renderEvtLayout(),b.afterRender(),b.bindEvt());f.log(b)},bindEvt:function(){var a=this,b=a._evtEls,c=function(){for(var c in a._stocks)if(a._stocks[c].stocks)return c}(),d=a._points[c],g=a._stocks[c];k.detach(i(".ks-chart-evtlayout-rects",i(".ks-chart-evtlayout",a._$ctnNode)),"mouseenter");c&&k.on(i(".ks-chart-evtlayout-rects",i(".ks-chart-evtlayout",a._$ctnNode)),"mouseenter",function(b){var d=i(b.currentTarget),b=d.attr("index"),d=d.attr("line_index");
c!=d&&(c=d,a.lineChangeTo(c));k.fire(i(".ks-chart-evtlayout-areas",i(".ks-chart-evtlayout",a._$ctnNode))[b],"mouseenter")});k.detach(i(".ks-chart-evtlayout-areas",i(".ks-chart-evtlayout",a._$ctnNode)),"mouseenter");c&&k.on(i(".ks-chart-evtlayout-areas",i(".ks-chart-evtlayout",a._$ctnNode)),"mouseenter",function(){var b=f.indexOf(this,i(".ks-chart-evtlayout-areas",i(".ks-chart-evtlayout",a._$ctnNode)));g=a._stocks[c];for(var e in a._stocks)for(var k in a._stocks[e].stocks)a._stocks[e].stocks[k]&&a._stocks[e].stocks[k].attr(a._stocks[e].attr);
if(d&&d[b]&&d[b].y){if(a._pointlines){for(e in a._pointlines)a._pointlines[e].hide();a._pointlines[b].show()}if(a._cfg.comparable)for(e in a._stocks)a._stocks[e].stocks&&a._stocks[e].stocks[b].attr(a._stocks[e].hoverAttr);else g.stocks[b].attr(g.hoverAttr);a._areas[b].addClass(a._cfg.themeCls+"-areas-hover").siblings().removeClass(a._cfg.themeCls+"-areas-hover");a._points[c][b].dataInfo&&(a.stockChange(c,b),a._cfg.tip.isShow&&a.tipHandler(c,b))}});k.detach(b.paper.$paper,"mouseleave");c&&k.on(b.paper.$paper,
"mouseleave",function(){a._lines[c].line.attr(a._lines[c].attr);a.tip&&a.tip.hide();for(var b in a._pointlines)a._pointlines[b].hide();for(b in a._areas)a._areas[b].removeClass(a._cfg.themeCls+"-areas-hover");for(b in a._stocks)for(var d in a._stocks[b].stocks)a._stocks[b].stocks[d]&&a._stocks[b].stocks[d].attr(a._stocks[b].attr);a.paperLeave()})},lineChangeTo:function(a){var b=this._cfg,c;for(c in this._lines)c!=a&&this._lines[c].line.attr(this._lines[c].attr);this._lines[a].line.remove();for(c in this._stocks[a].stocks)this._stocks[a].stocks[c].remove();
this._lines[a].line=this.drawLine(this.getLinePath(this._points[a]),{stroke:this.color.getColor(a).DEFAULT,"stroke-width":"4px"});this._stocks[a].stocks=this.drawStocks(this._points[a],{fill:this.color.getColor(a).DEFAULT});for(c in this._stocks)for(var d in this._stocks[c].stocks)this._stocks[c].stocks[d].attr(b.points.attr)},hideLine:function(a){m.prototype.removeData.call(this,a);this.animateGridsAndLabels();this._lines[a].line.remove();for(var b in this._stocks){if(a==b){for(var c in this._stocks[a].stocks)this._stocks[a].stocks[c].remove();
delete this._stocks[a].stocks}this._stocks[b].points=this._points[b]}for(b in this._lines)if(b!=a){var d=this.getLinePath(this._points[b]);if(this._lines[b].path!=d&&""!=d)for(c in this._lines[b].line.stop().animate({path:d},500),this._lines[b].path=d,this._stocks[b].stocks)this._stocks[b].stocks[c].stop().animate({cx:this._stocks[b].points[c].x,cy:this._stocks[b].points[c].y},500)}this.clearEvtLayout();this.renderEvtLayout();this.bindEvt();f.log(this)},showLine:function(a){m.prototype.recoveryData.call(this,
a);this.animateGridsAndLabels();var b=this.getLinePath(this._points[a]);this._lines[a].line=this.drawLine(b,this._lines[a].attr);for(var c in this._stocks)this._stocks[c].points=this._points[c];for(c in this._lines)if(c!=a&&(b=this.getLinePath(this._points[c]),this._lines[c].path!=b)){this._lines[c].line.stop().animate({path:b},500);this._lines[c].path=b;for(var d in this._stocks[c].stocks)this._stocks[c].stocks[d].stop().animate({cx:this._stocks[c].points[d].x,cy:this._stocks[c].points[d].y},500)}for(c in this._stocks)a==
c&&(this._stocks[a].stocks=this.drawStocks(this._stocks[a].points,this._stocks[a].attr));this.clearEvtLayout();this.renderEvtLayout();this.bindEvt()},animateGridsAndLabels:function(){Math.max(this._pointsY.length,this._gridsY.length);for(var a in this._labelY)this._labelY[a][0].remove(),this._gridsY[a][0].remove();this.drawGridsY();this.drawLabelsY()},tipHandler:function(a,b){var c=this._lines[a].color.DEFAULT,d=this.tip,g=this._cfg,i=d.getInstance();if(this._cfg.comparable){var e={datas:{}},k=[],
h;for(h in this._points)this._stocks[h].stocks&&(e.datas[h]=f.mix(this._points[h][b].dataInfo,{text:this._cfg.series[h].text||"",color:this._stocks[h].color.DEFAULT}));for(h in e.datas)k.push(e.datas[h]);e.datas=m.prototype.arraySort(k,!0,"y");d.renderTemplate(this._cfg.tip.template,e)}else d.renderTemplate(this._cfg.tip.template,this._points[a][b].dataInfo);d.isVisable()?d.animateTo(this._points[a][b].x,this._points[a][b].y):d.moveTo(this._points[a][b].x,this._points[a][b].y);i.css(this.processAttr(g.tip.css,
c))},paperLeave:function(){this.fire("paperLeave",this)},stockChange:function(a,b){var c=this._stocks[a];this.fire("stockChange",f.mix({target:c.stocks[b],currentTarget:c.stocks[b],lineIndex:Math.round(a),stockIndex:Math.round(b)},c.points[b]))},afterRender:function(){this.fire("afterRender",this)},getPaper:function(){return this.htmlPaper},clear:function(){return this.paper.clear()}});return q},{requires:"base,gallery/kcharts/1.0/raphael/index,gallery/kcharts/1.0/basechart/index,gallery/kcharts/1.0/tools/color/index,gallery/kcharts/1.0/tools/htmlpaper/index,gallery/kcharts/1.0/tip/index,./assets/kcharts-ui-core.css".split(",")});
