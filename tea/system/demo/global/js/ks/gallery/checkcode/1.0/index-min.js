KISSY.add("Message2",function(a){var f=function(c,d){this.title=(this.msg=a.one(c))&&this.msg.one(".msg-tit");this.content=this.msg&&this.msg.one(".msg-cnt");this.source=a.isPlainObject(d)?d:null;this.type=this._getType()};a.augment(f,{change:function(a,d){if(!this.msg)return this;this.show();a=a&&a.toUpperCase()||"";switch(a){case "OK":case "ERROR":case "TIPS":case "NOTICE":case "ATTENTION":case "QUESTION":case "STOP":this._changeType(a)}this.type=this._getType();this._changeText(d);return this},
_changeType:function(a){var d=this.msg.attr("class"),f=/\bmsg-ok\b|\bmsg-error\b|\bmsg-tips\b|\bmsg-notice\b|\bmsg-attention\b|\bmsg-question\b|\bmsg-stop\b/g;d.match(f)?this.msg.attr("class",d.replace(f,"msg-"+a.toLowerCase())):this.msg.addClass("msg-"+a.toLowerCase())},_changeTitle:function(c){this.title&&a.isString(c)&&this.title.html(c)},_changeContent:function(c){this.content&&a.isString(c)&&this.content.html(this.source?this.source[c]||"":c)},_changeText:function(c){var d=a.isObject(c)&&a.isString(c.title)?
c.title:"",c=a.isObject(c)&&a.isString(c.content)?c.content:a.isString(c)?c:"";this._changeTitle(d);this._changeContent(c);!d&&!c&&this.msg&&this.msg.addClass("msg-weak")},ok:function(a){this.change("ok",a);return this},error:function(a){this.change("error",a);return this},tips:function(a){this.change("tips",a);return this},notice:function(a){this.change("notice",a);return this},attention:function(a){this.change("attention",a);return this},question:function(a){this.change("question",a);return this},
stop:function(a){this.change("stop",a);return this},weak:function(){this.msg.replaceClass("msg","msg-weak");this.msg.replaceClass("msg-b","msg-b-weak")},_getType:function(){var a="",d=this.msg.attr("class");d.match(/\bmsg-(b-)?error\b/)?a="ERROR":d.match(/\bmsg-(b-)?-tips\b/)?a="TIPS":d.match(/\bmsg-(b-)?-attention\b/)?a="ATTENTION":d.match(/\bmsg-(b-)?-notice\b/)?a="NOTICE":d.match(/msg-ok|msg-b-ok/)?a="OK":d.match(/\bmsg-(b-)?-question\b/)?a="QUESTION":d.match(/\bmsg-(b-)?-stop\b/)&&(a="STOP");
return a},isHide:function(){return"hidden"==this.msg.css("visibility")||"none"==this.msg.css("display")},hide:function(){this.msg.css("visibility","hidden").removeClass("show").addClass("hide");return this},show:function(){this.msg.css("visibility","visible").removeClass("hide").addClass("show");return this},laterHide:function(c){a.later(this.hide,c,!1,this);return this}});return function(a,d){return new f(a,d)}});
KISSY.add("gallery/checkcode/1.0/index",function(a){var f=a.DOM,c=1,d=/^[\da-zA-Z]{4}$/,l=-1!==navigator.userAgent.indexOf("Windows"),m=a.UA.ie,j=a.UA.firefox,k=a.now(),h=a.now(),g={},i=function(b){if(!(this instanceof i))return new i(b);b=a.isObject(b)?b:{};this.input=b.input&&a.one(b.input);this.container=b.container&&a.one(b.container);this.prefixCls=a.isString(b.prefixCls)?b.prefixCls:"";this.identity=a.isString(b.identity)?b.identity:"";this.sessionid=a.isString(b.sessionid)?b.sessionid:"";this.apiserver=
a.isString(b.apiserver)&&b.apiserver?b.apiserver:"http://pin.aliyun.com";this.type=b.type||"default";this.checkedCode="";this.uid=c++};a.augment(i,a.EventTarget,{init:function(){if(this.container&&this.input&&this.identity&&this.sessionid){if(this.INITED)return this;this.createStyle();this.create();this.bind();this.INITED=!0;return this}},createStyle:function(){var b=".{{prefixCls}}checkcode-img,.{{prefixCls}}checkcode-audio{width:175px;height:32px;line-height:32px;position:absolute;}.{{prefixCls}}checkcode-audio{display:none;}.{{prefixCls}}checkcode-img img,.{{prefixCls}}checkcode-audio audio{float:left;display:inline;width:100px;height:30px;border:1px solid #CDCDCD;cursor:pointer;}.{{prefixCls}}checkcode-refresh{display:none;width:100px;height:30px;vertical-align:middle;border:1px solid #CDCDCD;position:absolute;left:0;top:0;cursor:pointer;}.{{prefixCls}}audio-state{float:left;display:inline;width:100px;height:30px;border:1px solid #CDCDCD;position:relative;}.{{prefixCls}}audio-state-text{display:block;width:70px;height:30px;padding-left:30px;font-size:12px;color:#999;text-decoration:none;background:url(http://img01.taobaocdn.com/tps/i1/T1HVriXnVeXXbjRy2i-21-169.png) no-repeat 10px -93px;z-index:1;position:absolute;cursor:text;}.{{prefixCls}}audio-state-text:hover{text-decoration:none;}.{{prefixCls}}audio-state-progress{width:0;height:30px;background-color:#186BCA;position:absolute;left:0;top:0;z-index:0;}.{{prefixCls}}audio-over{width:100px;padding-left:0;color:#186BCA;text-align:center;background:none;cursor:pointer;}.{{prefixCls}}audio-over:hover{text-decoration:underline;}.{{prefixCls}}checkcode-refresher{float:left;display:inline;width:32px;height:32px;vertical-align:top;text-indent:-9999em;outline:none;border-right:1px solid #DDD;background:url(http://img01.taobaocdn.com/tps/i1/T1HVriXnVeXXbjRy2i-21-169.png) no-repeat 7px -145px;}.{{prefixCls}}checkcode-switcher{float:left;display:inline;width:32px;height:32px;vertical-align:top;text-indent:-9999em;outline:none;background:url(http://img01.taobaocdn.com/tps/i1/T1HVriXnVeXXbjRy2i-21-169.png) no-repeat 0 0;}.{{prefixCls}}checkcode-refresher,.{{prefixCls}}checkcode-switcher{filter:alpha(opacity=70);opacity:0.7;}.{{prefixCls}}checkcode-refresher:hover,.{{prefixCls}}checkcode-switcher:hover{filter:alpha(opacity=100);opacity:1;border-color:#EAEAEA;}.{{prefixCls}}audio-switcher{background-position:6px -40px;}.{{prefixCls}}img-switcher{background-position:5px 10px;}".replace(/{{prefixCls}}/g,
this.prefixCls),a=f.create("<style>",{type:"text/css"});a.styleSheet?a.styleSheet.cssText=b:a.appendChild(document.createTextNode(b));f.append(a,"head")},create:function(){var b=this.uid;this.container.html(a.substitute('<div class="{prefixCls}checkcode-img" id="J_ImgCode{uid}"><img id="J_CheckCodeImg{uid}" width="100" height="30" onmousedown="return false;"/><a href="#nogo" onmousedown="return false;" role="button" title="\u91cd\u65b0\u83b7\u53d6\u9a8c\u8bc1\u7801" aria-label="\u91cd\u65b0\u83b7\u53d6\u9a8c\u8bc1\u7801" id="J_ImgRefresher{uid}" class="{prefixCls}checkcode-refresher">\u91cd\u65b0\u83b7\u53d6\u9a8c\u8bc1\u7801</a><a href="#nogo" onmousedown="return false;" role="button" title="\u83b7\u53d6\u8bed\u97f3\u9a8c\u8bc1\u7801" aria-label="\u83b7\u53d6\u8bed\u97f3\u9a8c\u8bc1\u7801" id="J_AudioSwitcher{uid}" class="{prefixCls}checkcode-switcher {prefixCls}audio-switcher">\u83b7\u53d6\u8bed\u97f3\u9a8c\u8bc1\u7801</a></div><div class="{prefixCls}checkcode-audio" id="J_AudioCode{uid}"><span class="{prefixCls}audio-state" id="J_AudioState{uid}"><a href="#nogo" class="{prefixCls}audio-state-text" id="J_AudioStateText{uid}" onmousedown="return false;"></a><span class="{prefixCls}audio-state-progress" id="J_AudioStateProgress{uid}"></span></span><a href="#nogo" role="button" onmousedown="return false;" title="\u91cd\u65b0\u83b7\u53d6\u9a8c\u8bc1\u7801" aria-label="\u91cd\u65b0\u83b7\u53d6\u9a8c\u8bc1\u7801" id="J_AudioRefresher{uid}" class="{prefixCls}checkcode-refresher">\u91cd\u65b0\u83b7\u53d6\u9a8c\u8bc1\u7801</a><a href="#nogo" role="button" onmousedown="return false;" title="\u83b7\u53d6\u56fe\u7247\u9a8c\u8bc1\u7801" aria-label="\u83b7\u53d6\u56fe\u7247\u9a8c\u8bc1\u7801" id="J_ImgSwitcher{uid}" class="{prefixCls}checkcode-switcher {prefixCls}img-switcher">\u83b7\u53d6\u56fe\u7247\u9a8c\u8bc1\u7801</a></div>',
{prefixCls:this.prefixCls,uid:b}));this.imgCode=a.one("#J_ImgCode"+b);this.audioCode=a.one("#J_AudioCode"+b);this.imgSwitcher=a.one("#J_ImgSwitcher"+b);this.audioSwitcher=a.one("#J_AudioSwitcher"+b);this.refresher=a.all("."+this.prefixCls+"checkcode-refresher");this.img=a.one("#J_CheckCodeImg"+b);this.audioState=a.one("#J_AudioState"+b);this.audioStateText=a.one("#J_AudioStateText"+b);this.audioProgress=a.one("#J_AudioStateProgress"+b);b={apiserver:this.apiserver,identity:this.identity,sessionid:this.sessionid,
type:this.type};this.getImgURL=a.substitute("{apiserver}/get_img?identity={identity}&sessionid={sessionid}&kjtype={type}",b);this.checkImgURL=a.substitute("{apiserver}/check_img?identity={identity}&sessionid={sessionid}&delflag=0",b);this.getAudioURL=a.substitute("{apiserver}/get_audio?identity={identity}&sessionid={sessionid}",b);this.checkAudioURL=a.substitute("{apiserver}/check_audio?identity={identity}&sessionid={sessionid}&delflag=0",b);this.CREATED=!0},bind:function(){var b=this;this.bindImg();
this.bindAudio();this.refresher.on("click",function(a){a.halt();b.refresh();b.focus()});this.input.on("valuechange",function(b){if((!b.prevVal||0===b.prevVal.length||4===b.prevVal.length)&&1===b.newVal.length)h=a.now()}).on("paste",function(){0===this.value.length&&(h=a.now())})},bindImg:function(){if(!this.img)return this;var a=this;this.img&&this.img.on("click",function(){a.refresh();a.focus()}).on("load",function(){}).on("error",function(){a.log({e:"IMGERROR"})});this.imgSwitcher&&this.imgSwitcher.on("click",
function(c){c.halt();a.switchTo("img");a.focus()});return this},bindAudio:function(){var a=this;this.audioSwitcher.on("click",function(c){c.halt();a.switchTo("audio");a.refresh();a.focus()});this.audioStateText.on("click",function(c){c.halt();a.audioOver&&(a.refresh(),a.focus())});return this},bindAudioProgress:function(){var a=this;if(this.audioSupport)this.audio.on("timeupdate",function(){j&&(!this.duration||Infinity===this.duration)?a.progress(100):a.progress(parseInt(100*this.currentTime/this.duration))},
this.audio[0]).on("play",function(){},this.audio[0]).on("ended",function(){a.progress(100)},this.audio[0])},switchTo:function(b){if(!b||!a.isString(b))return this;b=b.toUpperCase();"IMG"===b?(this.audioCode.hide(),this.stopAudio(),this.imgCode.css({display:"block"}),this.codeType=b):"AUDIO"===b&&(this.imgCode.hide(),this.audioProgress.width(0),this.audioStateText.removeClass(this.prefixCls+"audio-replay"),this.audioCode.css({display:"block"}),this.codeType=b);this.checkedCode="";this.toggleRefresher();
this.SHOWED=!0;this.fire("switch");return this},toggleRefresher:function(){"AUDIO"!==this.codeType?this.refresher.show():(!this.audioSupport||j)&&this.refresher.hide()},refreshImg:function(){if(!this.getImgURL)return this;this.img.attr("src",this.getImgURL+(0<=this.getImgURL.indexOf("?")?"&t=":"?t=")+a.now());return this},refreshAudio:function(){if(!this.getAudioURL)return this;var b=this.getAudioURL+(0<=this.getAudioURL.indexOf("?")?"&t=":"?t=")+a.now();this.stopAudio();this.audioOver=!1;this.audioSupport?
(this.audioDuration=0,this.audio=a.one(new Audio(b)),this.audio[0].play(),this.bindAudioProgress()):(m?(b=f.create("<bgsound>",{autostart:!0,id:"J_BgSound"+this.uid,src:b}),f.append(b,"head"),this.player=a.one("#J_BgSound"+this.uid)):(a.one("body").append('<embed src="'+b+'" id="J_EmbedSound'+this.uid+'"'+(l?'type="application/x-mplayer2"':'type="audio/x-wav"')+" autostart hidden />"),this.player=a.one("#J_EmbedSound"+this.uid)),this.progress("NOPROGRESS"));return this},refresh:function(b){b=a.isString(b)&&
b?b.toUpperCase():this.codeType;"IMG"===b?this.refreshImg():"AUDIO"===b&&this.refreshAudio();this.checkedCode="";this.fire("refresh");k=h=a.now()},focus:function(){this.input[0].focus();this.input[0].select()},stopAudio:function(){this.audioSupport?this.audio&&this.audio[0]&&this.audio[0].pause():this.player&&(this.player[0].src="",this.player.remove(),this.player=null)},replayAudio:function(){this.audioSupport&&this.audio&&(this.audio[0].currentTime=0,this.audio[0].pause(),this.audio[0].play())},
showImg:function(){this.switchTo("img");this.refresh();return this},showAudio:function(){this.switchTo("audio");return this},audioSupport:function(){try{return"Audio"in window&&(new Audio).canPlayType("audio/x-wav")}catch(a){return!1}}(),progress:function(a){switch(a){case -1:this.audioStateText.text("\u6b63\u5728\u52a0\u8f7d");break;case 100:case "NOPROGRESS":this.audioOver=!0;this.audioProgress.css({width:"0"});this.audioStateText.addClass(this.prefixCls+"audio-over").text("\u70b9\u51fb\u64ad\u653e\u8bed\u97f3");break;default:this.audioStateText.removeClass(this.prefixCls+
"audio-over").text("\u8bf7\u4ed4\u7ec6\u6536\u542c"),this.audioProgress.css({width:a+"%"})}},check:function(b){var c=a.trim(this.input.val()),b=a.isFunction(b)?b:function(){};if(d.test(c))if(this.checkedCode&&this.checkedCode===c)b({success:!0,codeType:this.codeType});else{g[c]=b;if(this.checkingCode){if(this.checkingCode===c)return;this.io&&this.io.abort&&this.io.abort()}this.checkingCode=c;a.later(function(){this._check(b)},500,!1,this)}else b({success:!1,codeType:this.codeType})},_check:function(){function b(){"IMG"===
e.codeType?e.refresh():(e.progress(100),e.stopAudio());e.checkedCode="";g[d]&&g[d]({success:!1,codeType:e.codeType})}var c="IMG"==this.codeType?this.checkImgURL:this.checkAudioURL,d=a.trim(this.input.val()),e=this;e.io=a.io({url:c,data:{code:d},dataType:"jsonp",success:function(c){e.checkingCode="";e.log({t1:a.now()-h,t2:a.now()-k,s:c&&"SUCCESS."===c.message,t:e.codeType});c&&"SUCCESS."===c.message?(e.progress(100),e.stopAudio(),e.checkedCode=d,g[d]&&g[d]({success:!0,codeType:e.codeType})):b()},error:function(){b()}})},
log:function(b){b&&((new Image).src="http://acjs.aliyun.com/captchaerror?"+a.param(b))}});return a.checkcode=i});
