KISSY.add("gallery/reflection/1.0/index",function(h,e){return e},{requires:["./reflection"]});
KISSY.add("gallery/reflection/1.0/reflection",function(h){function e(a,c){this.defaultOpacity=this.defaultHeight=0.5;this.add(a||".reflect",c)}function n(a,c){if(a.complete)c();else h.Event.on(a,"load",c)}var f=h.DOM;e.prototype._addOne=function(a,c){this._removeOne(a);var e={height:this.defaultHeight,opacity:this.defaultOpacity};if(c)for(var h in e)c[h]||(c[h]=e[h]);else c=e;try{var d=f.create("<div></div>"),b="object"==typeof a?a:f.get(a),o=b.className.replace("reflect",""),l=Math.floor(b.height*
c.height),p=Math.floor(b.height*(1+c.height)),i=b.width,j=f.create("<canvas></canvas>");if(j.getContext){d.className=o;b.className="reflected";d.style.cssText=b.style.cssText;b.style.cssText="vertical-align: bottom";var g=j.getContext("2d");j.style.height=l+"px";j.style.width=i+"px";j.height=l;j.width=i;d.style.width=i+"px";d.style.height=p+"px";b.parentNode.replaceChild(d,b);d.appendChild(b);d.appendChild(j);g.save();g.translate(0,b.height-1);g.scale(1,-1);g.drawImage(b,0,0,i,b.height);g.restore();
g.globalCompositeOperation="destination-out";var m=g.createLinearGradient(0,0,0,l);m.addColorStop(0,"rgba(255, 255, 255, "+(1-c.opacity)+")");m.addColorStop(1,"rgba(255, 255, 255, 1.0)");g.fillStyle=m;g.rect(0,0,i,l);g.fill()}else{"A"==b.parentElement.tagName&&(d=f.create("<a></a>"),d.href=b.parentElement.href);d.className=o;b.className="reflected";d.style.cssText=b.style.cssText;b.style.cssText="vertical-align: bottom";var k=f.create("<img>");k.src=b.src;k.style.width=i+"px";k.style.display="block";
k.style.height=b.height+"px";k.style.marginBottom="-"+(b.height-l)+"px";k.style.filter="progid:DXImageTransform.Microsoft.BasicImage(mirror=1,rotation=2) progid:DXImageTransform.Microsoft.Alpha(opacity="+100*c.opacity+", style=1, finishOpacity=0, startx=0, starty=0, finishx=0, finishy="+100*c.height+")";d.style.width=i+"px";d.style.height=p+"px";b.parentNode.replaceChild(d,b);d.appendChild(b);d.appendChild(k)}}catch(n){}};e.prototype._removeOne=function(a){if((a=f.get(a))&&"reflected"==a.className)a.className=
a.parentNode.className,a.parentNode.parentNode.replaceChild(a,a.parentNode)};e.prototype.remove=function(a){var a=f.query(a),c=this;h.each(a,function(a){c.removeOne(a)})};e.prototype.add=function(a,c){var e=f.query(a),q=this;h.each(e,function(a){n(a,function(){var b=parseFloat(f.attr(a,"data-rheight")),e=parseFloat(f.attr(a,"data-ropacity"));q._addOne(a,c||{height:b,opacity:e})})})};return e});
