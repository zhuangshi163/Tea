KISSY.add("gallery/randombox/1.0/index",function(e){function f(a,b){if(!(this instanceof f))return new f;this.config=e.mix(g,a);this.list=this.config.list;this.domNum=this.list.length;this.rollTimes=this.config.rollTimes;this.cls=this.config.cls;this.beginIndex=0;this.duration=this.config.duration;this.speedSteps=this.config.speedSteps;this._init();this.callback="function"==typeof b?b:void 0}var h=e.all,g={rollTimes:4,cls:"sel-item",duration:40,speedSteps:[1,2,5]};e.augment(f,{_init:function(){var a=
this.domNum;this.$domList=[];for(var b=this.curRollTimes=0;b<a;b++)this.$domList[b]=h(this.list[b]);this.changeTimes=a*this.rollTimes;this.config.finalId?(this.finalId=this.config.finalId,this.finalNum=this.changeTimes+this.indexOfArray(this.list,this.finalId)+1):(this.finalNum=this.getRandomNum(this.changeTimes,this.changeTimes+a),this.finalId=this.list[this.finalNum%a])},rolling:function(){this.choose(this.$domList[this.beginIndex%this.domNum]);this.beginIndex+=1;this.start();this.beginIndex==this.finalNum&&
(this._clearInterval(),this.callback(this.curTarget))},_setInterval:function(a){var b=this;b.interval=setInterval(function(){b.rolling()},a)},_clearInterval:function(){clearInterval(this.interval)},start:function(){var a=this.duration,b=this.speedSteps;this.stop();this.beginIndex<this.finalNum&&(this.beginIndex>this.finalNum-10?this._setInterval(a*b[2]):this.beginIndex<=this.finalNum-10&&this.beginIndex>=this.finalNum-20?this._setInterval(a*b[1]):this._setInterval(a*b[0]))},stop:function(){this._clearInterval()},
reset:function(){var a=this.$domList,b=this.domNum,c=this.cls;this.stop();this.beginIndex=0;this._init();for(var d=0;d<b;d++)a[d].hasClass(c)&&a[d].removeClass(c)},choose:function(a){var b=this;e.each(b.$domList,function(a){a.removeClass(b.cls)});a.addClass(b.cls);b.curTarget="#"+a.attr("id")||""},getRandomNum:function(a,b){return a?b?parseInt(Math.random()*(b-a)+a):parseInt(Math.random()*a):0},indexOfArray:function(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c]==b)return c;return-1}});return e.RandomBox=
f});
