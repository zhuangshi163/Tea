KISSY.add("gallery/easycountdown/1.0/easycountdown",function(d){function i(a,c){cfg={timeBegin:new Date,collateurl:"#",collateval:0};this._timeStart=new Date;this.config=d.merge(cfg,c||{});this.timeRemain=this._countTime(a)}function f(a,c,b){b=d.merge(f.Config,b||{});b.run&&!d.isFunction(b.run)&&delete b.run;b.end&&!d.isFunction(b.end)&&delete b.end;d.isNumber(b.interval)||(b.interval=200);f.superclass.constructor.call(this,c,b);this.counter(a)}function k(a,c){function b(a,b){1E3>a?c(b):3>g?e():c(new Date(b.setMilliseconds(b.getMilliseconds()+
a/2)))}function e(){var c=new Date;g++;d.io({url:a,type:"HEAD",success:function(a,d,e){b(new Date-c,new Date(e.getResponseHeader("date")))},error:function(){b()},cache:!1})}var g=0;e()}var n=d.all,m=d.DOM,o=["d","h","m","s","i"],j={d:864E5,h:36E5,m:6E4,s:1E3,i:1},h=function(a){return d.isDate(a)?a:/^(\d{4})\-(\d{1,2})\-(\d{1,2})(\s+)(\d{1,2}):(\d{1,2}):(\d{1,2})$/ig.test(a.replace(/\./g,"-"))?(a=a.match(/\d+/g),new Date(a[0],a[1]-1,a[2],a[3],a[4],a[5])):null};i.prototype={_countTime:function(a){var c=
this.config.timeBegin,b=0;if(!d.isDate(a))if(h(a))a=h(a);else{if(isNaN(parseInt(a)))return-1;a=parseInt(a)}d.isDate(a)&&d.isDate(h(c))?b=a-h(c):d.isNumber(a)&&d.isNumber(c)?b=a-c:d.isNumber(a)&&(b=a);return b},getRemain:function(){var a=parseInt(this.timeRemain-(new Date-this._timeStart));return isNaN(a)||0>=a?0:a},format:function(a){var c=Array.prototype.slice.call(arguments,1),b=[];d.each(c,function(c){if(j[c]){var d=Math.floor(a/j[c]);a-=d*j[c];b.push(d)}});return b},fetch:function(a,c,b){var d=
this,g=setInterval(function(){var a=d.getRemain();0<a?c&&c.call(d,a):(c&&c.call(d,0),b&&b.call(d),clearInterval(g))},a);return g}};f.Config={prefix:"ks-",interval:1E3,minDigit:2,timeRunCls:"countdown-run",timeEndCls:"countdown-end",timeUnitCls:{d:"d",h:"h",m:"m",s:"s",i:"i"}};d.extend(f,i,{counter:function(a){var c=this,b=c.config,e=[],g=[],f=b.prefix,h=b.timeUnitCls,a=n(a),l=a.all("."+f+b.timeRunCls),i=a.all("."+f+b.timeEndCls);d.each(o,function(b){var c=a.all("."+f+h[b]);h[b]&&0<c.length&&(e.push(c),
g.push(b))});l.show();i.hide();c.fetch(b.interval,function(a){var a=[a].concat(g),f=c.format.apply(c,a);d.each(e,function(a,b){a.text(f[b])});b.run&&b.run.call(c,a,f)},function(){l.hide();i.show();b.end&&b.end.call(c)})}});f.autoRender=function(a,c,b){var a="."+(a||"J_TWidget"),e=function(b){d.query(a,c).each(function(a){var c=m.attr(a,"data-widget-type"),e=m.attr(a,"data-widget-config");"Countdown"===c&&(e=d.isNull(e)?{}:JSON.parse(e.replace(/'/g,'"')),b&&d.isDate(b)&&(e.timeBegin=b),new f(a,e.endTime,
e))})};b?k(b,e):e()};f.Core=i;f.getServerTime=k;return f});KISSY.add("gallery/easycountdown/1.0/index",function(){return EasyCountdown},{requires:["./easycountdown"]});
