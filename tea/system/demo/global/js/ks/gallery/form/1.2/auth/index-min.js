KISSY.add("gallery/form/1.2/auth/base",function(c,j,e,g,a,i,b){var d={autoBind:true,stopOnError:false};var f={FORM:"form",OBJECT:"object"};var h=function(m,l){var n=c.get(m),k=this;k._storages={};if(!n){c.log("[Auth]:form element not exist")}else{k.mode=f.FORM;k._init(n,c.merge(d,l))}h.superclass.constructor.call(k);return k};c.extend(h,e,{_init:function(n,m){var l=n.elements,k=this;if(l&&l.length){c.each(l,function(q,o){var p=c.merge(m,{event:m.autoBind?i.getEvent(q):"none"});var r=new g(q,p);r.addTarget(k);r.publish("validate",{bubble:1});k.add(r)})}k.AuthConfig=m;if(k.mode===f.FORM){c.one(n).attr("novalidate","novalidate")}},add:function(p,m){var o,n,k=this;if(p instanceof g){o=p.get("el");n=c.one(o).attr("id")||c.one(o).attr("name");k._storages[n||i.guid()]=p}else{o=c.one(p);if(o){n=c.one(o).attr("id")||c.one(o).attr("name");var l=c.merge(k.AuthConfig,{event:k.AuthConfig.autoBind?i.getEvent(o):"none"},m);k._storages[n||i.guid()]=new g(o,l)}}return k},getField:function(k){return this._storages[k]},register:function(k,l){a.register(k,l);return this},validate:function(n){var l=this;l.fire("beforeValidate");var k=true,m;c.each(l._storages,function(q,o){var p=q.validate();k=k&&p;m=q;if(l.AuthConfig.stopOnError&&!k){return false}});l.fire("validate",{result:k,lastField:m});l.set("result",k);l.fire("afterValidate");return k}},{ATTRS:{result:{}}});c.mix(h,{Field:g});return h},{requires:["json","base","./field/field","./rule/ruleFactory","./utils"]});KISSY.add("gallery/form/1.2/auth/field/field",function(h,n,i,l,o,b,a,m,e,k,d){var c="",f="data-valid";var g={event:"blur",style:{success:"ok",error:"error"}};var j=function(s,r){var q=this;q._validateDone={};q._cache={};if(s&&o.attr(s,f)){var p=o.attr(s,f);p=k.toJSON(p);var t={rules:p};r=h.merge(t,r)}r=h.merge(g,r);q._cfg=r||{};q._storage={};q._init(s);j.superclass.constructor.call(q);return q};h.extend(j,i,{_init:function(t){var y=this,w=y._cfg,x=h.one(t),v=h.merge({},w.rules);if(h.inArray(x.attr("type"),["checkbox","radio"])){var s=x.getDOMNode().form,p=x.attr("name");var u=[];h.each(document.getElementsByName(p),function(z){if(z.form==s){u.push(z)}});y.set("el",u)}else{y.set("el",t)}var r=function(){y.fire("afterFieldValidation")};if(y._cfg.msg){y._msg=new e(x,y._cfg.msg);var q=y._cfg.style;y.on("afterRulesValidate",function(A){var z=A.result,B=A.curRule,C=y._cache[B].msg||c;if(y.get("result")!==z||y.get("msg")!==C){if(C){y._msg.show({style:z?q.success:q.error,msg:C})}else{y._msg.hide()}}})}y.on("afterRulesValidate",function(A){var z=A.result,B=A.curRule,C=y._cache[B].msg||c;y.set("result",z);y.set("message",C);y.fire("validate",{result:z,msg:C,errRule:z?"":B});y.fire("afterValidate");r()});h.each(b.HTML_PROPERTY,function(z){if(x.hasAttr(z)){var A=b.create(z,{propertyValue:x.attr(z),el:y.get("el"),msg:v[z]});y.add(z,A)}});h.each(v,function(B,z){if(!y._storage[z]&&b.rules[z]){var A=b.create(z,{el:y.get("el"),msg:B});y.add(z,A)}});if(w.event!="none"){n.on(y.get("el"),w.event||k.getEvent(x),function(z){y.validate()})}},add:function(r,t,p){var q=this,s=q._storage;if(t instanceof m||t instanceof a){s[r]=t}else{if(h.isFunction(t)){s[r]=new a(r,t,{el:q._el})}}if(s[r]){s[r].on("validate",function(u){h.log("[after rule validate]: name:"+u.name+",result:"+u.result+",msg:"+u.msg);q._cache[u.name]["result"]=u.result;q._cache[u.name]["msg"]=u.msg})}this._cache[r]={};return q},remove:function(p){var q=this._storage;delete q[p];delete this._cache[p];return this},validate:function(s,q){var p=true,r=this,v=r._storage,q=q||{},u=c;if(s){if(v[s]){r.fire("beforeValidate");p=v[s].validate(q.args);u=s}}else{r.fire("beforeValidate");for(var t in v){u=t;if(!v[t].validate(q.args)){p=false;break}}}if(u){r.fire("afterRulesValidate",{result:p,curRule:u})}return p}},{ATTRS:{message:{value:c},result:{},el:{}}});return j},{requires:["event","base","json","dom","../rule/ruleFactory","../rule/rule","../rule/html/propertyRule","../msg/base","../utils"]});KISSY.add("gallery/form/1.2/auth/index",function(b,a){return a},{requires:["./base"]});KISSY.add("gallery/form/1.2/auth/msg/base",function(b,a){var d="kf-msg";var c=function(g,e){var f=this;f._init(g,e);c.superclass.constructor.call(f)};b.extend(c,a,{_init:function(g,e){var f=this;f._el=b.one(g);f.set("tpl",e.tpl);f.set("args",e.args);f._msgContainer=b.one("."+d,f._el.parent());if(!f._msgContainer){f._msgContainer=b.one('<div class="'+d+'" style="display: none"></div>');f._el.parent().append(f._msgContainer)}},hide:function(){this._msgContainer.hide()},show:function(f){var e=this;f=b.merge(e.get("args"),f);b.buffer(function(){e._msgContainer.html(b.substitute(e.get("tpl"),f));e._msgContainer.show()},50)()}},{ATTRS:{tpl:{value:""},args:{value:{}}}});return c},{requires:["base"]});KISSY.add("gallery/form/1.2/auth/rule/base",function(c,b,f){var g="success",e="error",d={success:"",error:""};var a=function(){var j=[].slice.call(arguments),i=this;i.validation=j[0]?j[0]:function(){return true};var h=c.merge({},j[1]);if(j[1]){i._args=c.isArray(h.args)?h.args:[h.args]}if(!c.isPlainObject(h.msg)){h.msg={error:h.msg}}i._msg=c.merge(d,h.msg);a.superclass.constructor.call(i)};c.extend(a,b,{validate:function(){var h=this;var i=[].slice.call(arguments);var k=h.validation.apply(h,i.length?i:h._args);var j;if(h._msg){j=k?h._msg[g]:h._msg[e]}else{j=k?h._msg[g]:""}h.fire("beforeValidate");h.fire(k?g:e,{msg:j});h.fire("validate",{result:k,msg:j,name:h._name});h.fire("afterValidate");return k}},{ATTRS:{msg:{value:"",setter:function(h){this._msg=c.merge(this._msg,h)}}}});return a},{requires:["base"]});KISSY.add("gallery/form/1.2/auth/rule/html/propertyRule",function(b,a,d,e){var c=function(){var g=this;var h=[].slice.call(arguments);if(!h.length){b.log("please use a name to define property");return}g._name=h[0];var f=h[2]||{args:[]};g._initArgs=f.args;g._propertyValue=f.propertyValue;g._el=f.el;c.superclass.constructor.apply(g,h.slice(1))};b.extend(c,a,{validate:function(){var f=this;if(b.isUndefined(arguments[0])){return c.superclass.validate.apply(this,[f._propertyValue,d.getValue(f._el)].concat(f._initArgs))}else{var g=[].slice.call(arguments);f._initArgs=g;return c.superclass.validate.apply(this,[f._propertyValue,d.getValue(f._el)].concat(g))}}});return c},{requires:["../base","../../utils"]});KISSY.add("gallery/form/1.2/auth/rule/rule",function(b,a,d,e){var c=function(){var g=this;var h=[].slice.call(arguments);if(!h.length){b.log("please use a name to define rule");return}g._name=h[0];var f=h[2]||{args:[]};g._initArgs=f.args;g._el=f.el;c.superclass.constructor.apply(g,h.slice(1))};b.extend(c,a,{validate:function(){var f=this;if(b.isUndefined(arguments[0])){return c.superclass.validate.apply(this,[d.getValue(f._el)].concat(f._initArgs))}else{var g=[].slice.call(arguments);f._initArgs=g;return c.superclass.validate.apply(this,[d.getValue(f._el)].concat(g))}}});return c},{requires:["./base","../utils"]});KISSY.add("gallery/form/1.2/auth/rule/ruleFactory",function(c,b,e,d,f){var a=function(){var g=this;a.superclass.constructor.call(g)};a.rules={};c.mix(a.rules,{required:function(g,h){if(c.isArray(h)){return h.length>0}return !!h},pattern:function(g,h){return new RegExp(g).test(h)},max:function(g,h){if(!c.isNumber(h)){return false}return h<=g},min:function(g,h){if(!c.isNumber(h)){return false}return h>=g},step:function(g,h){if(!c.isNumber(h)){return false}if(h==0||g==1){return true}return h%g},equalTo:function(g,h){if(c.isNumber(h)){return g===h}if(c.one(g)){return c.one(g).val()===h}return g===h}});c.mix(a,{HTML_PROPERTY:["required","pattern","max","min","step","equalTo"],register:function(g,h){a.rules[g]=h},create:function(h,g){if(c.inArray(h,a.HTML_PROPERTY)){return new e(h,a.rules[h],g)}else{if(a.rules[h]){return new d(h,a.rules[h],g)}}return f}});return a},{requires:["base","./html/propertyRule","./rule"]});KISSY.add("gallery/form/1.2/auth/utils",function(S,DOM,undefined){var Utils={toJSON:function(cfg){cfg=cfg.replace(/'/g,'"');try{eval("cfg="+cfg)}catch(e){S.log("data-valid json is invalid")}return cfg},guid:function(){return"AUTH_"+S.guid()},getEvent:function(els){var event="blur",type=DOM.attr(els,"type");switch(type){case"select-multiple":case"radio":case"checkbox":event="click";break;default:event="blur"}return event},getValue:function(els){var val=[],type=DOM.attr(els,"type");switch(type){case"select-multiple":S.each(els.options,function(el){if(el.selected){val.push(el.value)}});break;case"radio":case"checkbox":S.each(els,function(el){if(el.checked){val.push(el.value)}});break;default:val=DOM.val(els)}return val}};return Utils},{requires:["dom"]});