KISSY.add("gallery/form/1.3/spinbox/index",function(e,k,l){function g(a,b){b=e.merge({target:c(a)},b);g.superclass.constructor.call(this,b)}var c=k.all,h=e.DOM;e.extend(g,l,{render:function(){var a=this.get("target");if(!a.length||this._isNativeSpinBox())return!1;var b=this.get("cls").init;a.hasClass(b)||a.addClass(b);this._loadCss();this._addHTML();this._eventOnChangeNum();this._eventOnValide()},_isNativeSpinBox:function(){return"number"==this.get("target").attr("type")?!0:!1},_addHTML:function(){var a=
this.get("target"),b=this.get("cls"),d=this.get("ariaLabel");a.each(function(a){var f=a.parent(),j=c(h.create('<span class="'+b.container+'">')),e=c(h.create('<a href="#!/plus" class="'+b.plus+" "+b.sign+'">+</a>')),g=c(h.create('<a href="#!/minus" class="'+b.minus+" "+b.sign+'">-</a>'));a.attr({"aria-label":d});j.append(g).append(a).append(e);f.append(j)})},_eventOnChangeNum:function(){var a=this,b=a.get("cls");c("."+b.sign).on("click",function(d){var i=c(this).parent().children("."+b.init),f=Number(i.val().trim()),
e=Number(i.attr("data-range").trim())||1;-1<d.target.className.indexOf(b.plus)?f+=e:-1<d.target.className.indexOf(b.minus)&&(f-=e);a._limitRange(f,i)})},_eventOnValide:function(){var a=this,b=a.get("target");b.on("blur",function(){a._formatNum(c(this));a._limitRange(Number(b.val().trim()),c(this))})},_toFloat:function(a){return parseFloat(a)},_formatNum:function(a){var b=Number(a.attr("data-min"))||1,d=this._toFloat(a.val().replace(/[^\d\.]/g,"")),d=isNaN(d)?b:Math.max(d,b);a.val(d.toFixed(2))},_limitRange:function(a,
b){var d=this._toFloat,c=d(b.attr("data-min"))||1,d=d(b.attr("data-max"))||1,c=c&&Math.max(c,a),c=d&&Math.min(d,c);b.val(c.toFixed(2))},_loadCss:function(){var a=this.get("cssUrl");""!=a&&e.use(a)}},{ATTRS:{target:{value:"",setter:function(a){return c(a)},getter:function(a){return c(a)}},cls:{value:{init:"ks-spinbox",sign:"ks-spinbox-sign",plus:"ks-spinbox-plus",minus:"ks-spinbox-minus",container:"ks-plus-minus-operation"}},ariaLabel:{value:""},cssUrl:{value:"gallery/form/1.3/spinbox/index.css"}}});
return g},{requires:["node","base"]});
