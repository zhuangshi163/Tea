KISSY.add("gallery/calendar/1.0/index",function(f,q,r){function d(){d.superclass.constructor.apply(this,arguments);this.initializer()}var i=q.all,o=f.each,k=f.substitute,p=f.UA.ie,n=/\d+/g,j=/^((19|2[01])\d{2})-(0?[1-9]|1[012])-(0?[1-9]|[12]\d|3[01])$/,s=i(document.body),t=i(window),l=i(document);return f.TripCalendar=f.extend(d,r,{initializer:function(){this._setUniqueTag().renderUI();this._minDateCache=this.get("minDate");this._clickoutside=function(a){a=f.one(a.target);a.hasClass(this._triggerNodeClassName)||
a.hasClass(this._triggerNodeIcon)||a.parent("#"+this._calendarId)||this.hide()};this.get("container")||this.hide()},renderUI:function(){var a=f.one(this.get("container"));(a||s).append(this._initCalendarHTML(this.get("date")));this.boundingBox=f.one("#"+this._calendarId).css("position",a?"relative":"absolute");this._dateBox=this.boundingBox.one(".date-box");this._contentBox=this.boundingBox.one(".content-box");this._messageBox=this.boundingBox.one(".message-box");a||(this._inputWrap()._setDefaultValue(),
this.boundingBox.css("top","-9999px"));this.set("boundingBox",this.boundingBox);this.bindUI()._fixSelectMask()._setWidth()._setBtnStates()._setDateStyle()},bindUI:function(){this.on("afterMessageChange",this._setMessage);this.boundingBox.delegate("click","."+this._delegateClickClassName,this._DELEGATE.click,this);this.boundingBox.delegate("change","."+this._delegateChangeClassName,this._DELEGATE.change,this);if(this.get("container"))return this;this.boundingBox.delegate("mouseenter mouseleave","a",
this._DELEGATE.mouse,this);l.delegate("focusin","."+this._triggerNodeClassName,this._DELEGATE.focusin,this);l.delegate("keyup","."+this._triggerNodeClassName,this._DELEGATE.keyup,this);l.delegate("keydown","."+this._triggerNodeClassName,this._DELEGATE.keydown,this);l.delegate("click","."+this._triggerNodeIcon,this._DELEGATE.iconClick,this);l.delegate("click","."+this._triggerNodeClassName,this._DELEGATE.triggerNodeClick,this);t.on("resize",this._setPos,this);return this},syncUI:function(){!this.get("container")&&
this.get("triggerNode")&&this._inputWrap()},render:function(){this._dateBox.html(this._dateHTML());this._setWidth()._setDateStyle()._setBtnStates();this.fire("render");return this},nextMonth:function(){this.set("date",d.DATE.siblingsMonth(this.get("date"),1));this.render();this.fire("nextmonth");return this},prevMonth:function(){this.set("date",d.DATE.siblingsMonth(this.get("date"),-1));this.render();this.fire("prevmonth");return this},show:function(){l.on("click",this._clickoutside,this);this.boundingBox.show();
this._setDefaultDate().render();this.fire("show",{node:this.currentNode});return this},hide:function(){l.detach("click",this._clickoutside,this);this.boundingBox.hide();this.hideMessage();this.currentNode&&(this.currentNode.getDOMNode()._selected=null);this._cacheNode=null;this.fire("hide",{node:this.currentNode});return this},showMessage:function(){(function(a){a.fire("showmessage");setTimeout(function(){a._messageBox.addClass("visible")},5)})(this);return this},hideMessage:function(){this._messageBox.removeClass("visible");
this.fire("hidemessage");return this},getSelectedDate:function(){return this.get("selectedDate")},getCurrentNode:function(){return this.currentNode},getDateInfo:function(a){var b=-1,c=d.DATE.stringify(new Date),e=["\u4eca\u5929","\u660e\u5929","\u540e\u5929"];switch(!0){case a==c:b=0;break;case a==d.DATE.siblings(c,1):b=1;break;case a==d.DATE.siblings(c,2):b=2}!this._dateMap&&this.get("isHoliday")&&(this._dateMap=this._createDateMap());return this._dateMap&&this._dateMap[a]||e[b]||d.DATE.week(a)},_getDateStatus:function(a){return this.get("minDate")&&
d.DATE.parse(a)<d.DATE.parse(this.get("minDate"))||this.get("maxDate")&&d.DATE.parse(a)>d.DATE.parse(this.get("maxDate"))},_getHolidaysClass:function(a,b){var c=d.HOLIDAYS;switch(!0){case b:case !this.get("isHoliday"):return"";case a==d.DATE.stringify(new Date):return"today";case !0:for(var e in c)if(f.inArray(a,c[e]))return e;default:return""}},_getAttrNode:function(a,b,c){var e=null;o(a,function(a){if(f.one(a).attr(b)===c)return e=f.one(a)});return e},_setWidth:function(){(function(a,b,c){b.all(".inner, h4").css("width",
b.one("table").outerWidth());b.css("width",b.one(".inner").outerWidth()*a.get("count")+parseInt(c.css("borderLeftWidth"))+parseInt(c.css("borderRightWidth"))+parseInt(c.css("paddingLeft"))+parseInt(c.css("paddingRight")));if(6!==p)return this;b.one("iframe").css({width:b.outerWidth(),height:b.outerHeight()})})(this,this.boundingBox,this._contentBox);return this},_setValue:function(a){this.set("selectedDate",a);if(this.get("container"))return this;this._isInput(this.currentNode)&&this.currentNode.val(a);
switch(!0){case this.boundingBox.hasClass("calendar-bounding-box-style"):this.set("endDate",a);break;case !this.boundingBox.hasClass("calendar-bounding-box-style")&&!!this.get("finalTriggerNode"):this.set("startDate",a);(a=f.one(this.get("finalTriggerNode")))&&this.get("isAutoSwitch")&&a.getDOMNode().select();break;default:this.set("selectedDate",a)}return this},_setDateInfo:function(a){if(this.get("container")||!this.get("isDateInfo")||!this._isInput(this.currentNode))return this;this.currentNode.prev().html(j.test(a)?
this.getDateInfo(a):"");return this},_setDefaultValue:function(){var a=i(this.get("triggerNode")).item(0),b=i(this.get("finalTriggerNode")).item(0),c=a&&a.val(),e=b&&b.val();c&&j.test(c)&&(this.get("isDateInfo")&&a.prev().html(this.getDateInfo(c)),this.set("startDate",c));e&&j.test(e)&&(this.get("isDateInfo")&&b.prev().html(this.getDateInfo(e)),this.set("endDate",e));return this},_setDefaultDate:function(){if(this.get("container"))return this;this.get("startDate")&&(this.set("minDate",this.boundingBox.hasClass("calendar-bounding-box-style")?
this.get("startDate"):this._minDateCache),this.render());if(this.boundingBox.hasClass("calendar-bounding-box-style")&&d.DATE.parse(this.get("startDate"))>d.DATE.parse(this.get("endDate")))return this.set("date",this.get("startDate")||this.get("date")),this;this.set("date",this.currentNode.val()||this.get("date"));return this},_setDateStyle:function(){var a=this.boundingBox,b=this.get("startDate"),c=this.get("endDate"),e=this.get("selectedDate"),f=d.DATE.differ(b,c),a=a.all("td"),g=null,g=b&&this._getAttrNode(a,
"data-date",b),h=c&&this._getAttrNode(a,"data-date",c),e=e&&this._getAttrNode(a,"data-date",e);a.removeClass("start-date").removeClass("end-date").removeClass("selected-range").removeClass("selected-date");g&&g.addClass("start-date");h&&h.addClass("end-date");e&&e.addClass("selected-date");if(!b||!c||d.DATE.parse(b)>d.DATE.parse(c))return this;for(c=0;c<f-1;c++)b=d.DATE.siblings(b,1),(g=this._getAttrNode(a,"data-date",b))&&g.addClass("selected-range");return this},_setBtnStates:function(){var a=+d.DATE.siblingsMonth(this.get("date"),
0),b=this.get("maxDate"),c=this.get("minDate"),e=this.boundingBox.one(".prev-btn"),f=this.boundingBox.one(".next-btn"),g=this.boundingBox.one(".close-btn");c&&(c=+d.DATE.parse(c));b&&(b=+d.DATE.siblingsMonth(d.DATE.parse(b),1-this.get("count")));a<=(c||Number.MIN_VALUE)?e.addClass("prev-btn-disabled"):e.removeClass("prev-btn-disabled");a>=(b||Number.MAX_VALUE)?f.addClass("next-btn-disabled"):f.removeClass("next-btn-disabled");this.get("container")&&g.hide();return this},_setMessage:function(){this._messageBox.html(this.get("message"));
return this},_setUniqueTag:function(){var a=f.guid();this._calendarId="calendar-"+a;this._delegateClickClassName="delegate-click-"+a;this._delegateChangeClassName="delegate-change-"+a;this._triggerNodeIcon="trigger-icon-"+a;this._triggerNodeClassName="trigger-node-"+a;return this},_setPos:function(){(function(a,b){b&&setTimeout(function(){var c=b.offset().left,e=b.offset().top+b.outerHeight(),d=a.boundingBox.outerWidth(),g=a.boundingBox.outerHeight(),f=b.outerWidth(),i=b.outerHeight(),k=l.width()-
d,j=l.height()-g,g=e-g-i,d=c+f-d;e>j&&(e=0>g?e:g);c>k&&(c=0>d?c:d);a.boundingBox.css({top:e,left:c})},10)})(this,this.currentNode);return this},_inputWrap:function(){(function(a,b,c){b.each(function(b){if((a.get("isDateInfo")||a.get("isDateIcon"))&&a._isInput(b)&&!b.parent(".calendar-input-wrap")){var c=i(d.INPUT_WRAP_TEMPLATE);b.after(c);c.append(k(d.START_DATE_TEMPLATE,{delegate_icon:a._triggerNodeIcon})).append(b);a.get("isDateIcon")||b.prev().removeClass("calendar-start-icon")}b.addClass(a._triggerNodeClassName);
a._isInput(b)&&b.attr("autocomplete","off")});c.each(function(b){if((a.get("isDateInfo")||a.get("isDateIcon"))&&a._isInput(b)&&!b.parent(".calendar-input-wrap")){var c=i(d.INPUT_WRAP_TEMPLATE);b.after(c);c.append(k(d.END_DATE_TEMPLATE,{delegate_icon:a._triggerNodeIcon})).append(b);a.get("isDateIcon")||b.prev().removeClass("calendar-end-icon")}b.addClass(a._triggerNodeClassName);a._isInput(b)&&b.attr("autocomplete","off")})})(this,i(this.get("triggerNode")),i(this.get("finalTriggerNode")));return this},
_fixSelectMask:function(){6===p&&this.boundingBox.append("<iframe />");return this},_mouseenter:function(a){var b=this.boundingBox,c=this.get("startDate"),e=a.attr("data-date"),a=d.DATE.differ(c,e);b.all("td");var f=null;clearTimeout(this.leaveTimer);b.all("td").removeClass("hover");if(d.DATE.parse(c)>d.DATE.parse(e))return this;for(e=0;e<a-1;e++)c=d.DATE.siblings(c,1),(f=b.one('td[data-date="'+c+'"]'))&&f.addClass("hover")},_mouseleave:function(){(function(a){clearTimeout(a.leaveTimer);a.leaveTimer=
setTimeout(function(){a.boundingBox.all("td").removeClass("hover")},30)})(this)},_DELEGATE:{click:function(a){a.preventDefault();var a=f.one(a.currentTarget),b=a.attr("data-date");switch(!0){case a.hasClass("prev-btn")&&!a.hasClass("prev-btn-disabled"):this.prevMonth();break;case a.hasClass("next-btn")&&!a.hasClass("next-btn-disabled"):this.nextMonth();break;case a.hasClass("close-btn"):this.hide();break;case a&&a.hasClass(this._delegateClickClassName)&&this.boundingBox.hasClass("calendar-bounding-box-style")&&
b==this.get("minDate"):break;case !!b&&!a.hasClass("disabled"):this.get("container")||this.hide(),this._setValue(b)._setDateInfo(b)._setDateStyle().fire("dateclick",{date:b,dateInfo:this.getDateInfo(b)})}},change:function(){var a=this.boundingBox.all("."+this._delegateChangeClassName);this.set("date",a.item(0).val()+"-"+a.item(1).val()+"-01");this.render()},mouse:function(a){var b=f.one(a.currentTarget).parent("td");if(!b.hasClass("disabled"))switch(a.type){case "mouseenter":this.boundingBox.hasClass("calendar-bounding-box-style")&&
this.get("startDate")&&this._mouseenter(b);break;case "mouseleave":this._mouseleave()}},focusin:function(a){a=this.currentNode=f.one(a.currentTarget);this.boundingBox[this._inNodeList(a,i(this.get("triggerNode")))?"removeClass":"addClass"]("calendar-bounding-box-style");this.hideMessage();this._cacheNode&&this._cacheNode.getDOMNode()!=a.getDOMNode()&&this.hide();"none"==this.boundingBox.css("display")&&this.show()._setWidth()._setPos();this._cacheNode=a},keyup:function(a){if(this.get("isKeyup")){clearTimeout(this.keyupTimer);
var b=this,a=f.one(a.currentTarget);if(this._isInput(a)){var c=a.val();b._setDateInfo(c);j.test(c)&&(this.keyupTimer=setTimeout(function(){c=d.DATE.stringify(d.DATE.parse(c));b._setValue(c);b.set("date",c);b.render()},200))}}},keydown:function(a){9==a.keyCode&&this.hide()},iconClick:function(a){var a=(a=f.one(a.target).parent(".calendar-input-wrap").one("."+this._triggerNodeClassName))?a.getDOMNode():null,b=this.currentNode?this.currentNode.getDOMNode():null;(a!=b||"none"==this.boundingBox.css("display"))&&
a.focus()},triggerNodeClick:function(a){a=a.target;!a._selected&&this._isInput(f.one(a))&&(a.select(),a._selected=!0)}},_maxCell:function(){for(var a=this.get("date"),b=a.getFullYear(),a=a.getMonth()+1,c=[],d=0;d<this.get("count");d++)c.push((new Date(b,a-1+d,1)).getDay()+(new Date(b,a+d,0)).getDate());return Math.max.apply(null,c)},_isInput:function(a){return"INPUT"===a.getDOMNode().tagName.toUpperCase()&&("text"===a.attr("type")||"date"===a.attr("type"))},_inNodeList:function(a,b){var c=!1;o(b,
function(b){a.equals(b)&&(c=!0)});return c},_createSelect:function(){var a=this.get("date"),b=this.get("minDate"),c=this.get("maxDate"),e=a.getFullYear(),a=d.DATE.filled(a.getMonth()+1),f=b&&b.substr(0,4)||1900,g=c&&c.substr(0,4)||(new Date).getFullYear()+3,b=b&&b.substr(5,2)||1,c=c&&c.substr(5,2)||12,h={};h.delegate_change=this._delegateChangeClassName;h.year_template="";h.month_template="";for(e==f||e==g||(b=1,c=12);g>=f;g--)h.year_template+="<option"+(e==g?' selected="selected"':"")+' value="'+
g+'">'+g+"</option>";for(g=b;g<=c;g++)h.month_template+="<option"+(a==g?' selected="selected"':"")+' value="'+d.DATE.filled(g)+'">'+d.DATE.filled(g)+"</option>";return k(d.SELECT_TEMPLATE,h)},_createDateMap:function(){var a={},b;for(b in d.HOLIDAYS)for(var c=d.HOLIDAYS[b],e=0;e<c.length;e++)for(var f=c[e],g=d.DATENAME[b],h=0;7>h;h++){var i=d.DATE.siblings(f,h-3),k=g+(3!=h?(3>h?"\u524d":"\u540e")+Math.abs(h-3)+"\u5929":"");a[i]=a[i]?2<h?k:a[i]:k}return a},_initCalendarHTML:function(){var a={};a.delegate_click=this._delegateClickClassName;
a.bounding_box_id=this._calendarId;a.message_template=this.get("message");a.date_template=this._dateHTML();return k(d.CALENDAR_TEMPLATE,a)},_dateHTML:function(a){for(var a=this.get("date"),b=a.getFullYear(),a=a.getMonth(),c="",e=0;e<this.get("count");e++)c+=k(d.DATE_TEMPLATE,this._singleDateHTML(new Date(b,a+e)));return c},_singleDateHTML:function(a){var b=a.getFullYear(),c=a.getMonth()+1,e=(new Date(b,c-1,1)).getDay(),a=(new Date(b,c,0)).getDate(),f="";o([{wd:"\u65e5",weekend:"weekend"},{wd:"\u4e00"},{wd:"\u4e8c"},
{wd:"\u4e09"},{wd:"\u56db"},{wd:"\u4e94"},{wd:"\u516d",weekend:"weekend"}],function(a){f+=k(d.HEAD_TEMPLATE,{weekday_name:a.wd,weekend:a.weekend||""})});for(var g="",h=[];e--;)h.push(0);for(e=1;e<=a;e++)h.push(e);h.length=this._maxCell();var i=Math.ceil(h.length/7);this.get("data");for(e=0;e<i;e++){for(var j="",l=0;6>=l;l++)var m=h[l+7*e]||"",a=m?b+"-"+d.DATE.filled(c)+"-"+d.DATE.filled(m):"",j=j+k(d.DAY_TEMPLATE,{day:m,date:a,disabled:this._getDateStatus(a)||!m?"disabled":this._delegateClickClassName,date_class:this._getHolidaysClass(a,
this._getDateStatus(a)||!m)});g+=k(d.BODY_TEMPLATE,{calday_row:j})}h={};h.head_template=f;h.body_template=g;g={};g.date=this.get("isSelect")?this._createSelect():b+"\u5e74"+c+"\u6708";g.table_template=k(d.TABLE_TEMPLATE,h);return g}},{DATE:{parse:function(a){return(a=a.match(n))?new Date(a[0],a[1]-1,a[2]):null},stringify:function(a){return!f.isDate(a)?null:a.getFullYear()+"-"+this.filled(1*a.getMonth()+1)+"-"+this.filled(a.getDate())},siblings:function(a,b){a=a.match(n);return this.stringify(new Date(a[0],
a[1]-1,1*a[2]+1*b))},siblingsMonth:function(a,b){return new Date(a.getFullYear(),1*a.getMonth()+b)},filled:function(a){return(""+a).replace(/^(\d)$/,"0$1")},differ:function(a,b){return parseInt(Math.abs(this.parse(a)-this.parse(b))/24/60/60/1E3)},isDate:function(a){return!j.test(a)?!1:1*this.parse(a).getMonth()+1==a.match(n)[1]},week:function(a){return"\u661f\u671f"+"\u65e5,\u4e00,\u4e8c,\u4e09,\u56db,\u4e94,\u516d".split(",")[d.DATE.parse(a).getDay()]}},CALENDAR_TEMPLATE:'<div id="{bounding_box_id}" class="calendar-bounding-box"><div class="calendar-container"><div class="message-box">{message_template}</div><div class="content-box"><div class="arrow"><span class="close-btn {delegate_click}" title="\u5173\u95ed">close</span><span class="prev-btn {delegate_click}" title="\u4e0a\u6708">prev</span><span class="next-btn {delegate_click}" title="\u4e0b\u6708">next</span></div><div class="date-box">{date_template}</div></div></div></div>',
DATE_TEMPLATE:'<div class="inner"><h4>{date}</h4>{table_template}</div>',SELECT_TEMPLATE:'<select class="{delegate_change}">{year_template}</select>\u5e74<select class="{delegate_change}">{month_template}</select>\u6708',TABLE_TEMPLATE:"<table><thead><tr>{head_template}</tr></thead><tbody>{body_template}</tbody></table>",HEAD_TEMPLATE:'<th class="{weekend}">{weekday_name}</th>',BODY_TEMPLATE:"<tr>{calday_row}</tr>",DAY_TEMPLATE:'<td data-date="{date}" class="{disabled}"><a href="javascript:;" class="{date_class}">{day}</a></td>',
INPUT_WRAP_TEMPLATE:'<div class="calendar-input-wrap" />',START_DATE_TEMPLATE:'<span class="calendar-start-icon {delegate_icon}" />',END_DATE_TEMPLATE:'<span class="calendar-end-icon {delegate_icon}" />',DATENAME:{today:"\u4eca\u5929",yuandan:"\u5143\u65e6",chuxi:"\u9664\u5915",chunjie:"\u6625\u8282",yuanxiao:"\u5143\u5bb5\u8282",qingming:"\u6e05\u660e",wuyi:"\u52b3\u52a8\u8282",duanwu:"\u7aef\u5348\u8282",zhongqiu:"\u4e2d\u79cb\u8282",guoqing:"\u56fd\u5e86\u8282"},HOLIDAYS:{yuandan:"2012-01-01,2013-01-01,2014-01-01,2015-01-01,2016-01-01,2017-01-01,2018-01-01,2019-01-01,2020-01-01".split(","),chuxi:"2012-01-22,2013-02-09,2014-01-30,2015-02-18,2016-02-07,2017-01-27,2018-02-15,2019-02-04,2020-01-24".split(","),
chunjie:"2012-01-23,2013-02-10,2014-01-31,2015-02-19,2016-02-08,2017-01-28,2018-02-16,2019-02-05,2020-01-25".split(","),yuanxiao:"2012-02-06,2013-02-24,2014-2-14,2015-03-05,2016-02-22,2017-02-11,2018-03-02,2019-02-19,2020-02-8".split(","),qingming:"2012-04-04,2013-04-04,2014-04-05,2015-04-05,2016-04-04,2017-04-04,2018-04-05,2019-04-05,2020-04-04".split(","),wuyi:"2012-05-01,2013-05-01,2014-05-01,2015-05-01,2016-05-01,2017-05-01,2018-05-01,2019-05-01,2020-05-01".split(","),duanwu:"2012-06-23,2013-06-12,2014-06-02,2015-06-20,2016-06-09,2017-05-30,2018-06-18,2019-06-07,2020-06-25".split(","),
zhongqiu:"2012-09-30,2013-09-19,2014-09-08,2015-09-27,2016-09-15,2017-10-04,2018-09-24,2019-09-13,2020-10-01".split(","),guoqing:"2012-10-01,2013-10-01,2014-10-01,2015-10-01,2016-10-01,2017-10-01,2018-10-01,2019-10-01,2020-10-01".split(",")},NAME:"TripCalendar",ATTRS:{boundingBox:{readOnly:!0},date:{value:new Date,setter:function(a){f.isDate(a)||(a=j.test(a)?a:new Date);return a},getter:function(a){if(f.isDate(a))return a;if(f.isString(a))return a=a.match(n),new Date(a[0],a[1]-1)}},count:{value:2,
getter:function(a){this.get("isSelect")&&(a=1);return a}},selectedDate:{value:null,setter:function(a){f.isDate(a)&&(a=d.DATE.stringify(a));return j.test(a)?a:null},getter:function(a){f.isString(a)&&(a=d.DATE.stringify(d.DATE.parse(a)));return a||""}},minDate:{value:null,setter:function(a){f.isDate(a)&&(a=d.DATE.stringify(a));return j.test(a)?a:null},getter:function(a){f.isString(a)&&(a=d.DATE.stringify(d.DATE.parse(a)));return a||""}},maxDate:{value:null,setter:function(a){f.isDate(a)&&(a=d.DATE.stringify(a));
return j.test(a)?a:null},getter:function(a){f.isString(a)&&(a=d.DATE.stringify(d.DATE.parse(a)));return a||""}},startDate:{value:""},endDate:{value:""},afterDays:{value:0,setter:function(a){0<a&&this.set("maxDate",d.DATE.siblings(this.get("minDate")||d.DATE.stringify(new Date),a));return a},getter:function(a){a&&(this.get("minDate")||this.set("minDate",new Date));return a}},message:{value:""},triggerNode:{value:"",getter:function(a){/\,/.test(a)&&(a=a.replace(/\s+/g,""),a=a.split(RegExp("\\s+"+a+
"+\\s","g")),a=a.join().replace(/^,+|,+$/g,""));return a}},finalTriggerNode:{value:"",getter:function(a){/\,/.test(a)&&(a=a.replace(/\s+/g,""),a=a.split(RegExp("\\s+"+a+"+\\s","g")),a=a.join().replace(/^,+|,+$/g,""));return a}},container:{value:null,getter:function(a){/\,/.test(a)&&(a=a.replace(/\s+/g,""),a=a.split(RegExp("\\s+"+a+"+\\s","g")),a=a.join().replace(/^,+|,+$/g,""));return a}},isSelect:{value:!1},isKeyup:{value:!0},isDateInfo:{value:!0},isDateIcon:{value:!0},isHoliday:{value:!0,setter:function(a){a||
(this._dateMap=null);return a}},isAutoSwitch:{value:!1}}})},{requires:["node","base","sizzle","./assets/index.css"]});
