KISSY.add("gallery/pagination/1.1/index",function(d,j){return j},{requires:["./pagination"]});
KISSY.add("gallery/pagination/1.1/pagination",function(d,j){function k(a){k.superclass.constructor.apply(this,arguments);this._init()}j.addStatement("for",{start:"for(KS_TEMPL_STAT_PARAM){",end:"}"});k.ATTRS={container:{setter:function(a){return d.isString(a)?d.one(a):a.offset?a:new d.Node(a)}},callback:{value:function(a,d,b){b(a)}},currentPage:{value:1,setter:function(a){return parseInt(a)}},linkTo:{value:"#"},displayPageCount:{value:2,setter:function(a){return parseInt(a)}},alwaysDisplayCount:{value:1,
setter:function(a){return parseInt(a)}},totalPage:{value:0,setter:function(a){a&&this.set("endPage",a+this.get("firstPage")-1)}},firstPage:{value:1,setter:function(a){return parseInt(a)}},endPage:{value:0},hasNext:{value:!0},ellipseText:{value:!0},loadCurrentPage:{value:!0},template:{value:""},pageRedirectHook:{value:"data-page"},isLoading:{value:!1},events:{value:{}}};d.extend(k,d.Base,{_init:function(){this.get("loadCurrentPage")?this.page(this.get("currentPage")):this.update();this._bind()},update:function(){var a=
this.get("currentPage"),e=this.get("displayPageCount"),b=this.get("firstPage"),c=this.get("endPage"),i=this.get("alwaysDisplayCount"),g,f,h=this.get("ellipseText");c&&h?(g=Math.min(Math.max(b,parseInt(a-e)),c-2*e),f=Math.min(c,g+2*e)):c&&(g=b,f=c);d.log([a,h,b,c,i,!!e,Math.max(g,b),Math.min(f,c),this.get("hasNext")]);this.get("container").html(j(this.get("template")).render({currentPage:a,ellipseText:h,startPage:b,endPage:c,alwaysDisplayCount:i,showPageNum:!!e,startIndex:Math.max(g,b),endIndex:Math.min(f,
c),hasNext:this.get("hasNext")}));this.fire("afterPageChange",{idx:a})},_bind:function(){var a=this,e=a.get("container");e.on("click",function(b){var c=new d.Node(b.target),c=parseInt(c.attr(a.get("pageRedirectHook")));isNaN(c)||(b.preventDefault(),a.get("isLoading")||a.page(c))});var b=a.get("events"),c=[];d.each(b,function(a){d.each(a,function(a,b){c.push(b)})});d.each(c,function(c){e.on(c,function(g){for(var f=new d.Node(g.target),h=[];f&&f[0]!==e[0];)d.each(b,function(a,b){f.hasClass(b)&&d.isFunction(a[c])&&
h.push(a[c])}),f=f.parent();d.each(h,function(b){b.call(a,g)})})})},page:function(a){function e(){c||b.update();b.set("isLoading",!1)}a=parseInt(a);if(!isNaN(a)){var b=this,c=b.get("endPage");if(!1!==b.fire("beforePageChange",{idx:a})){b.set("isLoading",!0);b.set("currentPage",a);c&&(b.set("hasNext",a<c),b.update());var i=b.get("callback");d.isFunction(i)&&i(a,b,e)}}},destroy:function(){this.get("container").detach();this.get("container").remove()}});return k},{requires:["gallery/template/1.0/index"]});
